(function(){var a,b,c;(function(d){function j(a,b){if(a&&a.charAt(0)==="."&&b){b=b.split("/"),b=b.slice(0,b.length-1),a=b.concat(a.split("/"));var c,d;for(c=0;d=a[c];c++)if(d===".")a.splice(c,1),c-=1;else if(d==="..")if(c!==1||a[2]!==".."&&a[0]!=="..")c>0&&(a.splice(c-1,2),c-=2);else break;a=a.join("/")}return a}function k(a,b){return function(){return i.apply(d,g.call(arguments,0).concat([a,b]))}}function l(a){return function(b){return j(b,a)}}function m(a){return function(b){e[a]=b}}function n(a){if(f.hasOwnProperty(a)){var b=f[a];delete f[a],h.apply(d,b)}return e[a]}function o(a,b){var c,d,e=a.indexOf("!");return e!==-1?(c=j(a.slice(0,e),b),a=a.slice(e+1),d=n(c),d&&d.normalize?a=d.normalize(a,l(b)):a=j(a,b)):a=j(a,b),{f:c?c+"!"+a:a,n:a,p:d}}var e={},f={},g=[].slice,h,i;if(typeof c=="function")return;h=function(a,b,c,g){var h=[],i,j,l,p,q,r;g||(g=a);if(typeof c=="function"){!b.length&&c.length&&(b=["require","exports","module"]);for(p=0;p<b.length;p++){r=o(b[p],g),l=r.f;if(l==="require")h[p]=k(a);else if(l==="exports")h[p]=e[a]={},i=!0;else if(l==="module")j=h[p]={id:a,uri:"",exports:e[a]};else if(e.hasOwnProperty(l)||f.hasOwnProperty(l))h[p]=n(l);else if(r.p)r.p.load(r.n,k(g,!0),m(l),{}),h[p]=e[l];else throw a+" missing "+l}q=c.apply(e[a],h),a&&(j&&j.exports!==d?e[a]=j.exports:i||(e[a]=q))}else a&&(e[a]=c)},a=i=function(a,b,c,e){return typeof a=="string"?n(o(a,b).f):(a.splice||(b.splice?(a=b,b=arguments[2]):a=[]),e?h(d,a,b,c):setTimeout(function(){h(d,a,b,c)},15),i)},i.config=function(){return i},b||(b=i),c=function(a,b,d){b.splice||(d=b,b=[]),c.unordered?f[a]=[a,b,d]:h(a,b,d)},c.amd={jQuery:!0}})(),c("../tools/almond",function(){}),function(){function a(){return!0}var b=function(){b.__waiting||(b.__waiting=[]),b.__waiting.push(arguments)};window.Butter||(window.Butter=b)}(),c("butter",function(){}),function(){var a=!0;c("core/logger",[],function(){function b(b){this.log=function(c){a&&console.log("["+b+"] "+c)},this.error=function(c){if(a)throw new Error("["+b+"]"+c)}}return b.debug=function(b){if(b!==undefined)a=b;else return a},b})}(),c("core/eventmanager",[],function(){var a=function(a){var b=[],c=this,d=this;this.repeat=function(a,b){for(var c=0;c<b.length;++c)a.listen(b[c],d.dispatch)},this.unrepeat=function(a,b){for(var c=0;c<b.length;++c)a.unlisten(b[c],d.dispatch)},this.dispatch=function(a,d){var e;typeof a!="object"?e={type:a+"",target:c,data:d}:(e={type:a.type,target:a.target,data:a.data},a=e.type),e.currentTarget=c;if(b[a]){var f=b[a].slice();for(var g=0,h=f.length;g<h;++g)f[g](e)}},this.listen=function(a,c){if(typeof a=="object")for(var e in a)a.hasOwnProperty(e)&&d.listen(e,a[e]);else b[a]||(b[a]=[]),b[a].push(c)},this.unlisten=function(a,c){if(typeof a=="object")for(var e in a)a.hasOwnProperty(e)&&d.unlisten(e,a[e]);else{var f=b[a];if(f)if(c){var g=f.indexOf(c);g>-1&&f.splice(g,1)}else b[a]=[]}},a&&(a.listen=d.listen,a.unlisten=d.unlisten,a.dispatch=d.dispatch,c=a)};return a}),c("util/dragndrop",[],function(){function j(a){var b=getComputedStyle(a),c=b.getPropertyValue("padding-top"),d=b.getPropertyValue("padding-left"),e=b.getPropertyValue("padding-bottom"),f=b.getPropertyValue("padding-right");return{top:Number(c.substring(0,c.indexOf("px"))),left:Number(d.substring(0,d.indexOf("px"))),bottom:Number(e.substring(0,e.indexOf("px"))),right:Number(f.substring(0,f.indexOf("px")))}}function k(){return{top:0,left:0,right:window.innerWidth,bottom:window.innerHeight}}function l(){var a=!1;for(var b=f.length-1;b>=0;--b){var c=f[b].drop();a=a||c}return a}function m(a,b,c){var d;for(var e=f.length-1;e>=0;--e)a!==f[e].element&&!d&&f[e].drag(a,b,c)?(f[e].remember(a),d=f[e]):f[e].forget()}function n(d,f){function o(f){function s(){var a=q-p,f=h+a,i=o-a;if(i<e)return;l&&l.scrollLeft>0&&g.left+a<m.left-c&&(l.scrollLeft-=b,f-=b,i+=b,p+=b),f<0&&(i+=f,f=0),d.style.left=f+"px",d.style.width=i+"px",n=d.getBoundingClientRect()}function t(a){window.removeEventListener("mousemove",u,!1),window.removeEventListener("mouseup",t,!1),clearInterval(k),k=-1,j()}function u(b){q=b.clientX,k===-1&&(k=setInterval(s,a),i())}f.stopPropagation();var g=d.getBoundingClientRect(),h=d.offsetLeft,o=d.offsetWidth,p=f.clientX,q,r;n=d.getBoundingClientRect(),r=f.clientX-n.left,m=l.getBoundingClientRect(),window.addEventListener("mousemove",u,!1),window.addEventListener("mouseup",t,!1)}function p(f){function r(){var a=p-o,f=h+a;if(f<e)return;l&&l.scrollLeft<l.scrollWidth-m.width&&p>m.right+c&&(l.scrollLeft+=b,o-=b),f+g>d.offsetParent.offsetWidth&&(f=d.offsetParent.offsetWidth-g),d.style.width=f+"px",n=d.getBoundingClientRect()}function s(a){window.removeEventListener("mousemove",t,!1),window.removeEventListener("mouseup",s,!1),clearInterval(k),k=-1,j()}function t(b){p=b.clientX,k===-1&&(k=setInterval(r,a),i())}f.stopPropagation();var g=d.offsetLeft,h=d.offsetWidth,o=f.clientX,p,q;n=d.getBoundingClientRect(),l&&(m=l.getBoundingClientRect()),q=f.clientX-n.left,window.addEventListener("mousemove",t,!1),window.addEventListener("mouseup",s,!1)}var g=document.createElement("div"),h=document.createElement("div"),i=f.start||function(){},j=f.stop||function(){},k=-1,l=f.scroll,m,n;return g.className="handle left-handle",h.className="handle right-handle",d.appendChild(g),d.appendChild(h),g.addEventListener("mousedown",o,!1),h.addEventListener("mousedown",p,!1),{destroy:function(){g.removeEventListener("mousedown",o,!1),h.removeEventListener("mousedown",p,!1),d.removeChild(g),d.removeChild(h)}}}function o(a,b){var c=b.image,d=b.start||function(){},e=b.stop||function(){},f=g.length;g[f]=a,a.setAttribute("draggable",!0),a.addEventListener("dragstart",function(b){h=a,b.dataTransfer.effectAllowed="all",b.dataTransfer.setData("text",f);if(c){var e=document.createElement("img");e.src=c.src,b.dataTransfer.setDragImage(e,e.width/2,e.height/2)}d()}),a.addEventListener("dragend",function(a){h=null,e()}),a.addEventListener("drop",function(a){})}function p(a,b){b=b||{};var c=b.hoverClass,d=b.drop||function(){},e=b.over||function(){},i=b.out||function(){},j,k,l;a.addEventListener("drop",function(b){b.preventDefault(),b.stopPropagation(),c&&a.classList.remove(c);var e=b.dataTransfer.getData("text"),f=g[e]||h;return f&&d(f,[b.clientX,b.clientY]),!1},!1),a.addEventListener("dragover",function(a){a.preventDefault(),a.dataTransfer.dropEffect="copy"},!1),a.addEventListener("dragenter",function(b){a.classList.add(c),c&&a.classList.add(c);var d=b.dataTransfer.getData("text"),f=g[d]||h;f&&e(f,[b.clientX,b.clientY])},!1),a.addEventListener("dragleave",function(b){a.classList.remove(c);var d=b.dataTransfer.getData("text"),e=g[d]||h;e&&i(e,[b.clientX,b.clientY])},!1),window.addEventListener("mousemove",function(a){j=[a.clientX,a.clientY]},!1),f.push({element:a,remember:function(b){l||(a.classList.add(c),l=b,e(l))},forget:function(){l&&(a.classList.remove(c),i(l),l=null)},drop:function(){return a.classList.remove(c),l?(d(l,j),l=null,!0):(l=null,!1)},drag:function(b,c,d){var e=a.getBoundingClientRect(),f=Math.max(c.left,e.left),g=Math.max(c.top,e.top),h=Math.min(c.right,e.right),i=Math.min(c.bottom,e.bottom);if(h<f||i<g)return!1;var j=[h-f,i-g];return j[0]*j[1]/2>c.width*c.height/4?!0:!1}})}function q(e,f){function C(){E(),h&&F(),I(),m(e,r,q)}function D(){u=g?g.getBoundingClientRect():k(),t=e.offsetParent?e.offsetParent.getBoundingClientRect():u,s=h?h.getBoundingClientRect():u,r=e.getBoundingClientRect()}function E(){var a=q[0]-p[0],b=q[1]-p[1],c=a+r.width,d=b+r.height;if(!n||n.indexOf("x")>-1)e.style.left=a-t.left+"px";if(!n||n.indexOf("y")>-1)e.style.top=b-t.top+"px";r=e.getBoundingClientRect()}function F(){r.right>s.right+c?(h.scrollLeft+=v,e.style.left=e.offsetLeft+v+"px",D()):r.left<s.left-c&&(h.scrollLeft-=v,e.style.left=e.offsetLeft-v+"px",D())}function G(a){if(a.which!==1)return;a.preventDefault(),a.stopPropagation(),window.addEventListener("mousemove",J,!1),window.addEventListener("mouseup",H,!1)}function H(a){window.removeEventListener("mousemove",J,!1),window.removeEventListener("mouseup",H,!1);if(x===-1)return;e.style.zIndex=w,clearInterval(x),x=-1,z(),!l()&&o&&(e.style.left=A[0]+"px",e.style.top=A[1]+"px")}function I(){var a=r.left,b=r.top,d=a+r.width,f=b+r.height;if(!n||n.indexOf("y")>-1)b<u.top?b=u.top:f>u.bottom&&(b=u.bottom-r.height),e.style.top=b-t.top-B.top+"px";if(!n||n.indexOf("x")>-1)d>s.right+c?(a=s.right+c-r.width,d=a+r.width):a<s.left-c&&(a=s.left-c,d=a+r.width),a<u.left?a=u.left:d>u.right&&(a=u.right-r.width),e.style.left=a-t.left-B.left+"px";r=e.getBoundingClientRect()}function J(b){q=[b.clientX,b.clientY],x===-1&&(A=[e.offsetLeft,e.offsetTop],w=getComputedStyle(e).getPropertyValue("z-index"),e.style.zIndex=d,D(),q=[b.clientX,b.clientY],p=[b.clientX-r.left,b.clientY-r.top],x=setInterval(C,a),y())}f=f||{};var g=f.containment,h=f.scroll,n=f.axis,o=f.revert,p,q,r,s,t,u,v=f.scrollAmount||b,w,x=-1,y=f.start||function(){},z=f.stop||function(){return!1},A,B=i;return g&&(B=j(g)),e.addEventListener("mousedown",G,!1),{destroy:function(){e.removeEventListener("mousedown",G,!1)}}}function r(a,b){function m(b){var c=b.cloneNode(!1);return c.classList.add("placeholder"),a.replaceChild(c,b),c}function n(a){h.style.top=i-a+"px"}function o(b){if(!j)j=!0,l=m(h),a.appendChild(h),h.style.position="absolute",h.style.zIndex=d,n(0);else{var f=g-b.clientY;n(f);var i=h.getBoundingClientRect();for(var o=e.length-1;o>=0;--o){var p=e[o];if(p===h)continue;var q=p.getBoundingClientRect(),r=Math.max(i.left,q.left),s=Math.max(i.top,q.top),t=Math.min(i.right,q.right),u=Math.min(i.bottom,q.bottom);if(t<r||u<s)continue;var v=[t-r,u-s];if(v[0]*v[1]/2>i.width*i.height/4){k=p;var w=m(k);a.replaceChild(k,l),l=w;var x=[],y=a.childNodes;for(var z=0,A=y.length;z<A;++z){var B=y[z];B!==h&&(B!==l?x.push(B):x.push(h))}c(x)}}}}function p(a){if(a.which!==1)return;j=!1,h=a.target,i=h.offsetTop;var b=getComputedStyle(h);_oldZIndex=b.getPropertyValue("z-index"),_oldPositionStyle=b.getPropertyValue("position"),g=a.clientY,window.addEventListener("mouseup",q,!1),window.addEventListener("mousemove",o,!1)}function q(b){h.style.zIndex=_oldZIndex,window.removeEventListener("mouseup",q,!1),window.removeEventListener("mousemove",o,!1),j=!1,l&&(h.style.zIndex="",h.style.position="",h.style.top="",a.replaceChild(h,l),l=null)}var c=b.change||function(){},e=[],f={},g,h,i,j,k,l;return f.addItem=function(a){e.push(a),a.addEventListener("mousedown",p,!1)},f.removeItem=function(a){e.splice(e.indexOf(a),1),a.removeEventListener("mousedown",p,!1)},f}var a=16,b=10,c=20,d=2147483647,e=15,f=[],g=[],h,i={top:0,left:0,bottom:0,right:0};return{draggable:q,droppable:p,helper:o,resizable:n,sortable:r}}),c("ui/position-tracker",[],function(){var a=20;return function(b,c){var d={};setInterval(function(){var a=b.getBoundingClientRect();if(a.left!==d.left||a.right!==d.right||a.top!==d.top||a.bottom!==d.bottom)d=a,c(d)},a)}}),c("ui/page-element",["core/logger","core/eventmanager","util/dragndrop","ui/position-tracker"],function(a,b,c,d){var e=function(){};return function(a,f,g){var h=typeof a=="string"?document.getElementById(a):a,i=document.createElement("div"),j=f||{},k=g||{},l=new b(this),m,n,o=this;d(h,function(a){i.style.left=a.left+"px",i.style.top=a.top+"px",i.style.width=a.width+"px",i.style.height=a.height+"px",l.dispatch("moved",a)}),this.highlight=_highlightFunction=function(a){a?(o.blink=m,i.style.visibility="visible",i.removeAttribute("data-blink")):(o.blink=e,i.style.visibility="hidden")},this.destroy=function(){i.parentNode&&i.parentNode.removeChild(i)},i.className="butter-highlight ",i.setAttribute("data-butter-exclude","true"),k.highlightClass&&(i.className+=k.highlightClass),i.style.visibility="hidden",this.blink=m=function(){o.blink=e,i.setAttribute("data-blink","true"),i.style.visibility="visible",setTimeout(function(){i.getAttribute("data-blink")!==!0&&(i.removeAttribute("data-blink"),i.style.visibility="hidden"),o.blink=m},1500)},h&&(document.body.appendChild(i),h.setAttribute("butter-clean","true"),c.droppable(h,{over:function(a){if(a.getAttribute("data-butter-draggable-type")!=="plugin")return;o.highlight(!0),j.over&&j.over()},out:function(a){if(a.getAttribute("data-butter-draggable-type")!=="plugin")return;o.highlight(!1),j.out&&j.out()},drop:function(a){if(a.getAttribute("data-butter-draggable-type")!=="plugin")return;o.highlight(!1),j.drop&&j.drop(a)}})),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return h}}})}}),function(){c("core/target",["core/logger","core/eventmanager","ui/page-element"],function(a,b,c){var d=0,e=function(e){e=e||{};var f="Target"+d++,g=new a(f),h=new b(this),i=e.name||f,j=e.element,k,l=this;typeof j=="string"&&(j=document.getElementById(j)),j?k=new c(j,{drop:function(a){h.dispatch("trackeventrequested",{element:a,target:l})}},{highlightClass:"butter-target-highlight"}):g.log("Warning: Target element is null."),Object.defineProperties(this,{view:{enumerable:!0,get:function(){return k}},name:{enumerable:!0,get:function(){return i}},id:{enumerable:!0,get:function(){return f}},elementID:{enumerable:!0,get:function(){if(j)return j.id}},element:{enumerable:!0,get:function(){return j}},isDefault:{enumerable:!0,get:function(){return j&&j.hasAttribute("data-butter-default")?!0:!1}},json:{enumerable:!0,get:function(){var a="";return j&&j.id&&(a=j.id),{id:f,name:i,element:a}},set:function(a){a.name&&(name=a.name),a.element&&(j=document.getElementById(a.element))}}})};return e})}(),c("util/lang",[],function(){return{extend:function(a){var b=a,c=[].slice.call(arguments,1);c.forEach(function(a){for(var c in a)b[c]=a[c]})},smpteToSeconds:function(a){var b=a.split(":");if(b.length===1)return parseFloat(b[0],10);if(b.length===2)return parseFloat(b[0],10)+parseFloat(b[1]/12,10);if(b.length===3)return parseInt(b[0]*60,10)+parseFloat(b[1],10)+parseFloat(b[2]/12,10);if(b.length===4)return parseInt(b[0]*3600,10)+parseInt(b[1]*60,10)+parseFloat(b[2],10)+parseFloat(b[3]/12,10)},secondsToSMPTE:function(a){var b=new Date(1970,0,1),c;return b.setSeconds(a),c=b.toTimeString().substr(0,8),c>86399&&(c=Math.floor((b-Date.parse("1/1/70"))/36e5)+c.substr(2)),c},clone:function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}}}),c("util/time",[],function(){function b(b){return Math.round(b*Math.pow(10,a))/Math.pow(10,a)}var a=3,c={roundTime:b};return Object.defineProperties(c,{timeAccuracy:{enumerable:!0,get:function(){return a},set:function(b){a=b}}}),c}),c("core/views/trackevent-view",["core/logger","core/eventmanager","util/dragndrop"],function(a,b,c){var d=0;return function(a,e,f){function v(a){q[0].style.visibility=a?"visible":"hidden",q[1].style.visibility=a?"visible":"hidden"}function w(){i.style.left=m/k*j+"px",i.style.width=(n-m)/k*j+"px"}function x(){i.style.top="0px";var a=i.getClientRects()[0];m=i.offsetLeft/j,n=m+a.width/j,h.dispatch("trackeventviewupdated")}function y(a){o=!0,i.setAttribute("selected",!0)}function z(a){o=!1,i.removeAttribute("selected")}var g="TrackEventView"+d++,h=new b(this),i=document.createElement("div"),j=1,k=1,l=e,m=f.start||0,n=f.end||m+1,o=!1,p,q,r=document.createElement("div"),s,t,u=this;i.appendChild(r),this.setToolTip=function(a){i.title=a},this.update=function(a){a=a||{},i.style.top="0px",isNaN(a.start)||(m=a.start),isNaN(a.end)||(n=a.end),w()},Object.defineProperties(this,{trackEvent:{enumerable:!0,get:function(){return a}},element:{enumerable:!0,get:function(){return i}},start:{enumerable:!0,get:function(){return m},set:function(a){m=a,w()}},end:{enumerable:!0,get:function(){return n},set:function(a){n=a,w()}},type:{enumerable:!0,get:function(){return l},set:function(a){l=a,r.innerHTML=l,i.setAttribute("data-butter-trackevent-type",l)}},selected:{enumerable:!0,get:function(){return o},set:function(a){a?y():z()}},zoom:{enumerable:!0,get:function(){return j},set:function(a){j=a,w()}},duration:{enumerable:!0,get:function(){return i.getBoundingClientRect().width/j},set:function(a){w()}},id:{enumerable:!0,configurable:!1,get:function(){return g}},parent:{enumerabled:!0,get:function(){return p},set:function(b){p=b,s&&(s.destroy(),s=null),t&&(v(!1),t.destroy(),t=null,q=null),p&&(p.element&&p.element.parentNode&&p.element.parentNode.parentNode&&(s=c.draggable(i,{containment:p.element.parentNode,scroll:p.element.parentNode.parentNode,start:function(){h.dispatch("trackeventdragstarted")},stop:function(){h.dispatch("trackeventdragstopped"),x()},revert:!0}),t=c.resizable(i,{containment:p.element.parentNode,scroll:p.element.parentNode.parentNode,stop:x}),i.setAttribute("data-butter-draggable-type","trackevent"),i.setAttribute("data-butter-trackevent-id",a.id),q||(q=i.querySelectorAll(".handle"),q&&q.length===2&&(i.addEventListener("mouseover",function(a){v(!0)},!1),i.addEventListener("mouseout",function(a){v(!1)},!1),v(!1)))),w())}}}),i.className="butter-track-event",u.type=l,i.id=g,u.update(f),i.addEventListener("mousedown",function(b){h.dispatch("trackeventmousedown",{originalEvent:b,trackEvent:a})},!1),i.addEventListener("mouseup",function(b){h.dispatch("trackeventmouseup",{originalEvent:b,trackEvent:a})},!1),i.addEventListener("mouseover",function(b){h.dispatch("trackeventmouseover",{originalEvent:b,trackEvent:a})},!1),i.addEventListener("mouseout",function(b){h.dispatch("trackeventmouseout",{originalEvent:b,trackEvent:a})},!1),i.addEventListener("dblclick",function(b){h.dispatch("trackeventdoubleclicked",{originalEvent:b,trackEvent:a})},!1)}}),c("core/trackevent",["./logger","./eventmanager","util/lang","util/time","./views/trackevent-view"],function(a,b,c,d,e){var f=0,g=function(g){g=g||{};var h=this,i="TrackEvent"+f++,j=g.name||i,k=new a(i),l=new b(this),m,n=g.type+"",o=[],p=g.popcornOptions||{start:0,end:1},q=new e(this,n,p),r=!1;h.popcornOptions=p,n||k.log("Warning: "+i+" has no type."),p.start=p.start||0,p.start=d.roundTime(p.start),p.end=p.end||p.start+1,p.end=d.roundTime(p.end),this.update=function(a){var b=!1,c=p.start,e=p.end;isNaN(a.start)||(c=d.roundTime(a.start)),isNaN(a.end)||(e=d.roundTime(a.end));if(c>=e)b="invalidtime";else if(m&&m._media){var f=m._media;if(c>f.duration||e>f.duration||c<0)b="invalidtime"}if(b)l.dispatch("trackeventupdatefailed",b);else{for(var g in a)a.hasOwnProperty(g)&&(p[g]=a[g]);c&&(p.start=c),e&&(p.end=e),q.update(p),h.popcornOptions=p,l.dispatch("trackeventupdated",h)}},this.moveFrameLeft=function(a,b){b?p.end-p.start>a?p.end-=a:p.end=p.start:p.start>a?(p.start-=a,p.end-=a):(p.end=p.end-p.start,p.start=0),l.dispatch("trackeventupdated",h),q.update(p)},this.moveFrameRight=function(a,b){p.end<m._media.duration-a?(p.end+=a,b||(p.start+=a)):(b||(p.start+=m._media.duration-p.end),p.end=m._media.duration),l.dispatch("trackeventupdated",h),q.update(p)},q.listen("trackeventviewupdated",function(a){p.start=q.start,p.end=q.end,l.dispatch("trackeventupdated")}),Object.defineProperties(this,{_track:{enumerable:!0,get:function(){return m},set:function(a){m=a,h.update(p)}},view:{enumerable:!0,configurable:!1,get:function(){return q}},type:{enumerable:!0,get:function(){return n}},name:{enumerable:!0,get:function(){return j}},id:{enumerable:!0,get:function(){return i}},selected:{enumerable:!0,get:function(){return r},set:function(a){a!==r&&(r=a,q.selected=r,r?l.dispatch("trackeventselected"):l.dispatch("trackeventdeselected"))}},json:{enumerable:!0,get:function(){return{id:i,type:n,popcornOptions:c.clone(p),track:m?m.name:undefined,name:j}},set:function(a){n=p.type=a.type,a.name&&(j=a.name),p=a.popcornOptions,h.popcornOptions=p,q.type=n,q.update(p),l.dispatch("trackeventupdated",h)}}})};return g}),c("core/views/track-view",["core/logger","core/eventmanager","util/dragndrop"],function(a,b,c){var d=0;return function(a){function o(){k.style.width=l*n+"px"}var e="TrackView"+d++,f=a,g=this,h=[],i=[],j=new b(this),k=document.createElement("div"),l=1,m,n=1;k.className="butter-track",k.id=e,c.droppable(k,{hoverClass:"draggable-hover",drop:function(a,b){var c=a.getAttribute("data-butter-draggable-type"),d,e,g=k.getBoundingClientRect();if(c==="plugin"){var h=a.getAttribute("data-butter-plugin-type");e=b[0]-g.left,d=e/g.width*l,j.dispatch("plugindropped",{start:d,track:f,type:a.getAttribute("data-butter-plugin-type")})}else c==="trackevent"&&a.parentNode!==k&&(e=a.offsetLeft,d=e/g.width*l,j.dispatch("trackeventdropped",{start:d,track:f,trackEvent:a.getAttribute("data-butter-trackevent-id")}))}}),Object.defineProperties(this,{element:{enumerable:!0,configurable:!1,get:function(){return k}},zoom:{enumerable:!0,get:function(){return n},set:function(a){n=a,o();for(var b=0,c=h.length;b<c;++b)h[b].zoom=n}},duration:{enumerable:!0,get:function(){return l},set:function(a){l=a,o();for(var b=0,c=h.length;b<c;++b)h[b].duration=l}},parent:{enumerable:!0,get:function(){return m},set:function(a){m=a;for(var b=0,c=h.length;b<c;++b)h[b].parent=g}}}),this.addTrackEvent=function(a){var b=a.view.element;k.appendChild(b),h.push(a.view),i.push(a.view.element),a.view.zoom=n,a.view.duration=l,a.view.parent=g,j.repeat(a,["trackeventmousedown","trackeventmouseover","trackeventmouseout"])},this.removeTrackEvent=function(a){var b=a.view.element;k.removeChild(b),h.splice(h.indexOf(a.view),1),i.splice(h.indexOf(a.view.element),1),a.view.parent=null,j.unrepeat(a,["trackeventmousedown","trackeventmouseover","trackeventmouseout"])}}}),c("core/track",["./logger","./eventmanager","./trackevent","./views/track-view"],function(a,b,c,d){var e=0,f=function(f){f=f||{};var g=[],h="Track"+e++,i=f.target,j=new a(h),k=new b(this),l=f.name||h,m=f.order||0,n=new d(this),o=this;o._media=null,Object.defineProperties(this,{view:{enumerable:!0,configurable:!1,get:function(){return n}},order:{enumerable:!0,get:function(){return m},set:function(a){m=a,k.dispatch("trackorderchanged",m)}},target:{enumerable:!0,get:function(){return i},set:function(a){i=a,k.dispatch("tracktargetchanged",o);for(var b=0,c=g.length;b<c;b++)g[b].target=a,g[b].update({target:a});j.log("target changed: "+a)}},name:{enumerable:!0,configurable:!1,get:function(){return l}},id:{enumerable:!0,configurable:!1,get:function(){return h}},json:{enumerable:!0,get:function(){var a=[];for(var b=0,c=g.length;b<c;++b)a.push(g[b].json);return{name:l,id:h,trackEvents:a}},set:function(a){a.name&&(name=a.name);if(a.trackEvents){var b=a.trackEvents;for(var d=0,e=b.length;d<e;++d){var f=new c;f.json=b[d],o.addTrackEvent(f)}}}},trackEvents:{enumerable:!0,configurable:!1,get:function(){return g}}}),this.getTrackEventById=function(a){for(var b=0,c=g.length;b<c;++b)if(g[b].id===a)return g[b]},this.getTrackEventByName=function(a){for(var b=0,c=g.length;b<c;++b)if(g[b].name===a)return g[b]},this.addTrackEvent=function(a){return a instanceof c||(a=new c(a)),i&&(a.target=i),a._track=o,g.push(a),a.track=o,k.repeat(a,["trackeventupdated","trackeventselected","trackeventdeselected","trackeventeditrequested"]),n.addTrackEvent(a),a.track=o,k.dispatch("trackeventadded",a),a},this.removeTrackEvent=function(a){var b=g.indexOf(a);if(b>-1)return g.splice(b,1),k.unrepeat(a,["trackeventupdated","trackeventselected","trackeventdeselected","trackeventeditrequested"]),n.removeTrackEvent(a),a._track=null,k.dispatch("trackeventremoved",a),a},this.deselectEvents=function(a){for(var b=0,c=g.length;b<c;++b)g[b]!==a&&(g[b].selected=!1)}};return f}),c("core/popcorn-wrapper",["core/logger","core/eventmanager"],function(a,b){var c=/(?:http:\/\/www\.|http:\/\/|www\.|\.|^)(youtu|vimeo|soundcloud|baseplayer)/,d=100,e=1e4,f=1e4;return function(b,g){function y(a){return String(a).replace(/['\\"]/g,"\\$&")}function z(){for(var a in j)q.on(a,j[a])}function A(){for(var a in j)q.off(a,j[a])}function B(a){var b=c.exec(a);return b?(r=b[1],r==="youtu"&&(r="youtube")):r="object",r}function C(a){var b,c=document.getElementById(a);if(r!=="object"&&c&&["VIDEO","AUDIO"].indexOf(c.nodeName)!==-1){var d=c.parentNode,e=document.createElement("div");e.id=c.id,e.style.cssText=getComputedStyle(c).cssText,d.replaceChild(e,c)}}function E(a){var b=new Function("",a);popcorn=b();if(!popcorn){var c=document.createElement("script");c.innerHTML=a,document.head.appendChild(c),popcorn=window.Popcorn.instances[window.Popcorn.instances.length-1]}q=popcorn}function F(a,b,c,e){function i(){if(g)return;a()?(h=!0,b()):setTimeout(i,d)}var g=!1,h=!1;setTimeout(function(){h||(g=!0,c())},f),i()}function G(a,b){F(function(){return q.media.readyState>=2&&q.duration()>0},a,b,f)}function H(a,b){r!=="object"?(m(r),F(function(){return!!window.Popcorn[r]},a,b,e)):a()}var h=b,i=new a(h+"::PopcornWrapper"),j=g.popcornEvents||{},k=g.prepare||function(){},l=g.fail||function(){},m=g.playerTypeRequired||function(){},n=g.timeout||function(){},o=g.setup&&g.setup.url,p=g.target&&g.setup.target,q,r,s,t={},u=0,v=!1,w=!1,x=this;this.unbind=function(){try{A(),q.destroy(),q=undefined}catch(a){i.log("WARNING: Popcorn did NOT get destroyed properly: \n"+a.message+"\n"+a.stack)}},this.interruptLoad=function(){v=!0},this.updateEvent=function(a){var b=a.popcornOptions,c=a.id,d=t[c];if(q){d&&q.getTrackEvent(d)&&q.removeTrackEvent(d);if(q[a.type]){q[a.type](b),t[c]=q.getLastTrackEventId();if(a.view){var e=q.getTrackEvent(t[c]);e.toString?a.view.setToolTip(e.toString()):a.view.setToolTip(JSON.stringify(b))}}}},this.destroyEvent=function(a){var b=a.popcornOptions,c=a.id,d=t[c];q&&(d&&q.getTrackEvent(d)&&q.removeTrackEvent(d),delete t[c])},this.prepare=function(a,b,c){function d(a){v=!0,n(a)}function e(a){v=!0,i.log(a),l(a)}B(a);if(!b){i.log("Warning: tried to prepare media with null target.");return}if(!q)try{H(function(){C(b),E(D(c,a,b)),z(),G(k,d)},d)}catch(f){e(f)}};var D=this.generatePopcornString=function(a,b,c,d){var e="";a?a=", "+JSON.stringify(a):a=", {}",typeof c!="string"&&(c&&c.id?c=c.id:i.log("WARNING: Unexpected non-string Popcorn target: "+c));if(!r)throw new Error("Media type not generated yet. Please specify a url for media objects before generating a popcorn string.");r==="baseplayer"?e+="Popcorn.player( 'baseplayer' );\nvar popcorn = Popcorn.baseplayer( '#"+c+"', "+a+" );\n":e+="var popcorn = Popcorn.smart( '#"+c+"', '"+b+"'"+a+" );\n";if(q){var f=q.getTrackEvents();if(f)for(var g=0,h=f.length;g<h;++g){a=f[g]._natives.manifest.options,e+="popcorn."+f[g]._natives.type+"({";for(var j in a)a.hasOwnProperty(j)&&(e+="\n"+j+":'"+y(f[g][j])+"',");e[e.length-1]===","&&(e=e.substring(0,e.length-1)),e+="});\n"}}return d=d||"inline",d==="event"?(e="\ndocument.addEventListener('DOMContentLoaded',function(e){\n"+e,e+="\n},false);"):e+="\n return popcorn;",e};this.play=function(){q.play()},this.pause=function(){q.pause()},this.clear=function(a){typeof a=="string"&&(a=document.getElementById(a));if(!a){i.log("Warning: tried to clear media with null target.");return}if(q)try{A(),q.destroy(),q=undefined}catch(b){i.log("WARNING: Popcorn did NOT get destroyed properly: \n"+b.message+"\n"+b.stack)}while(a.firstChild)a.removeChild(a.firstChild);["AUDIO","VIDEO"].indexOf(a.nodeName)>-1&&(a.currentSrc="",a.src="")},Object.defineProperties(this,{volume:{enumerable:!0,set:function(a){q&&q.volume(a)},get:function(){return q?q.volume():!1}},muted:{enumerable:!0,set:function(a){q&&(a?q.mute():q.unmute())},get:function(){return q?q.muted():!1}},currentTime:{enumerable:!0,set:function(a){q&&q.currentTime(a)},get:function(){return q?q.currentTime():0}},duration:{enumerable:!0,get:function(){return q?q.duration():0}},popcorn:{enumerable:!0,get:function(){return q}},paused:{enumerable:!0,get:function(){return q?q.paused():!0},set:function(a){q&&(a?q.pause():q.play())}}})}}),c("ui/logo-spinner",[],function(){return function(a){var b=document.createElement("div"),c=document.createElement("div");return b.className="butter-logo-spin-outer",c.className="butter-logo-spin-inner",b.appendChild(c),a&&a.appendChild(b),{element:b,start:function(){b.classList.remove("fade-out"),c.classList.add("active")},stop:function(a){b.classList.add("fade-out"),setTimeout(function(){c.classList.remove("active"),a&&a()},500)}}}}),c("core/views/media-view",["ui/page-element","ui/logo-spinner"],function(a,b){var c="&#10003; HTML5 &#10003; YouTube &#10003; Vimeo";return function(d,e){function r(a,b){a?n.innerHTML=b:n.innerHTML=c}function s(){l.value.replace(/\s/g,"")!==""?d.url=l.value:r(!0,"Your URL must not be blank:")}function t(a){var b=a?a.data:g.element.getBoundingClientRect();i.style.left=b.left+"px",i.style.top=b.top+"px"}var f=d,g,h=e.onDropped||function(){},i=document.createElement("div"),j,k=this;i.className="butter-media-properties",i.setAttribute("data-butter-exclude",!0);var l=document.createElement("input");l.type="text",l.className="url";var m=document.createElement("h3");m.innerHTML="Timeline Media";var n=document.createElement("h5");n.innerHTML=c;var o=document.createElement("container");o.className="container";var p=document.createElement("button");p.innerHTML="Change";var q=document.createElement("div");q.className="loading-container",j=b(q),o.appendChild(m),o.appendChild(n),o.appendChild(l),o.appendChild(p),o.appendChild(q),i.appendChild(o),l.addEventListener("keypress",function(a){a.which===13&&s()},!1),p.addEventListener("click",s,!1),j.start(),p.setAttribute("disabled",!0),d.listen("mediacontentchanged",function(a){l.value=d.url,r(!1),p.setAttribute("disabled",!0),j.start()}),d.listen("mediafailed",function(a){r(!0,"Media failed to load. Check your URL:"),p.removeAttribute("disabled"),j.stop()}),d.listen("mediaready",function(a){r(!1),p.removeAttribute("disabled"),j.stop()}),this.blink=function(){g.blink()},this.update=function(){l.value=d.url;var b=document.getElementById(f.target);g&&g.destroy(),g=new a(f.target,{over:function(a){_draggingOver=!0},out:function(a){_draggingOver=!1},drop:function(a){h(a)}},{highlightClass:"butter-media-highlight"}),b&&(i.parentNode||document.body.appendChild(i),g.listen("moved",t))}}}),function(){c("core/media",["core/logger","core/eventmanager","core/track","core/popcorn-wrapper","core/views/media-view"],function(a,b,c,d,e){var f=500,g=10,h=0,i=function(i){function z(a){m.dispatch("trackeventrequested",a)}function A(a){var b=a.target,c=a.data;x.updateEvent(c)}function B(a){var b=a.target;x.updateEvent(b)}function C(a){var b=a.data;x.destroyEvent(b)}function D(){o&&q&&x.prepare(o,q,u),w&&w.update()}i=i||{};var j=[],k="Media"+h++,l=new a(k),m=new b(this),n=i.name||k,o=i.url,p=!1,q=i.target,r,s=0,t=0,u=i.popcornOptions,v,w,x=new d(k,{popcornEvents:{muted:function(){m.dispatch("mediamuted",y)},unmuted:function(){m.dispatch("mediaunmuted",y)},volumechange:function(){m.dispatch("mediavolumechange",x.volume)},timeupdate:function(){s=x.currentTime,m.dispatch("mediatimeupdate",y)},pause:function(){clearInterval(v),m.dispatch("mediapause")},playing:function(){v=setInterval(function(){s=x.currentTime},10),m.dispatch("mediaplaying")},timeout:function(){m.dispatch("mediatimeout"),m.dispatch("mediafailed","timeout")},ended:function(){m.dispatch("mediaended")}},prepare:function(){y.duration=x.duration,p=!0;for(var a=0,b=j.length;a<b;a++){var c=j[a].trackEvents;for(var d=0,e=c.length;d<e;d++)x.updateEvent(c[d])}m.dispatch("mediaready")},fail:function(a){m.dispatch("mediafailed","error")},playerTypeRequired:function(a){m.dispatch("mediaplayertyperequired",a)},setup:{target:q,url:o}}),y=this;this.createView=function(){w=new e(this,{onDropped:z})},this.destroy=function(){x.unbind()},this.clear=function(){while(j.length>0)y.removeTrack(j[0])},this.addTrack=function(a){a instanceof c||(a=new c(a)),a.order=j.length,a._media=y,j.push(a),m.repeat(a,["tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated","trackeventselected","trackeventdeselected","trackeventeditrequested"]),a.popcorn=x,a.listen("trackeventadded",A),a.listen("trackeventupdated",B),a.listen("trackeventremoved",C),m.dispatch("trackadded",a);var b=a.trackEvents;if(b.length>0)for(var d=0,e=b.length;d<e;++d)a.dispatch("trackeventadded",b[d]);return a},this.getTrackById=function(a){for(var b=0,c=j.length;b<c;++b)if(j[b].id===a)return j[b]},this.removeTrack=function(a){var b=j.indexOf(a);if(b>-1){j.splice(b,1);var c=a.trackEvents;for(var d=0,e=c.length;d<e;++d)a.dispatch("trackeventremoved",c[d]);return m.unrepeat(a,["tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated","trackeventselected","trackeventdeselected","trackeventeditrequested"]),a.unlisten("trackeventadded",A),a.unlisten("trackeventupdated",B),a.unlisten("trackeventremoved",C),m.dispatch("trackremoved",a),a._media=null,a}},this.findTrackWithTrackEventId=function(a){for(var b=0,c=j.length;b<c;++b){var d=j[b].getTrackEventById(a);if(d)return{track:j[b],trackEvent:d}}},this.getManifest=function(a){return r[a]},this.setupContent=D,this.onReady=function(a){function b(c){a(c),m.unlisten("mediaready",b)}p?a():m.listen("mediaready",b)},this.pause=function(){x.pause()},this.play=function(){x.play()},Object.defineProperties(this,{ended:{enumerable:!0,get:function(){return x.popcorn?x.popcorn.ended():!1}},url:{enumerable:!0,get:function(){return o},set:function(a){o!==a&&(o=a,x.clear(q),D(),m.dispatch("mediacontentchanged",y))}},target:{get:function(){return q},set:function(a){q!==a&&(x.clear(q),q=a,D(),m.dispatch("mediatargetchanged",y))},enumerable:!0},muted:{enumerable:!0,get:function(){return x.muted},set:function(a){x.muted=a}},ready:{enumerable:!0,get:function(){return p}},name:{get:function(){return n},enumerable:!0},id:{get:function(){return k},enumerable:!0},tracks:{get:function(){return j},enumerable:!0},currentTime:{get:function(){return s},set:function(a){a!==undefined&&(s=a,s<0&&(s=0),s>t&&(s=t),x.currentTime=s,m.dispatch("mediatimeupdate",y))},enumerable:!0},duration:{get:function(){return t},set:function(a){a&&(t=a,l.log("duration changed to "+t),m.dispatch("mediadurationchanged",y))},enumerable:!0},json:{get:function(){var a=[];for(var b=0,c=j.length;b<c;++b)a.push(j[b].json);return{id:k,name:n,url:o,target:q,duration:t,tracks:a}},set:function(a){a.name&&(n=a.name),a.target&&(y.target=a.target),a.url&&(y.url=a.url);if(a.tracks){var b=a.tracks;for(var d=0,e=b.length;d<e;++d){var f=new c;f.json=b[d],y.addTrack(f)}}},enumerable:!0},registry:{get:function(){return r},set:function(a){r=a},enumerable:!0},popcorn:{enumerable:!0,get:function(){return x}},paused:{enumerable:!0,get:function(){return x.paused},set:function(a){x.paused=a}},volume:{enumerable:!0,get:function(){return x.volume},set:function(a){x.volume=a}},view:{enumerable:!0,get:function(){return w}},popcornOptions:{enumerable:!0,get:function(){return u},set:function(a){u=a,m.dispatch("mediapopcornsettingschanged",y),D()}},popcornString:{enumerable:!0,get:function(){return x.generatePopcornString(u,o,q)}}});var E=document.getElementById(q);if(E&&["VIDEO","AUDIO"].indexOf(E.nodeName)>-1)if(!E.currentSrc&&E.getAttribute("src")||E.childNodes.length>0)var F=0,G=setInterval(function(){E.currentSrc?(o=E.currentSrc,D(),clearInterval(G)):F++===g&&clearInterval(G)},f)};return i})}(),c("core/page",["core/logger","core/eventmanager"],function(a,b){return function(a){var c=a.baseURL["popcorn-dir"],d=c+"popcorn.js",e=c+"modules/player/popcorn.player.js",f=c+"players/{type}/popcorn.{type}.js",g=new b(this);this.scrape=function(){var a=document.body,b=a.querySelectorAll("*[data-butter='target']"),c=a.querySelectorAll("*[data-butter='media']");return{media:c,target:b}},this.preparePopcorn=function(a){function b(a){var b=document.createElement("script");b.src=a,document.head.appendChild(b)}function c(a){window.Popcorn?a():setTimeout(function(){c(a)},100)}function f(){window.Popcorn.player?a():setTimeout(function(){f()},100)}function g(){window.Popcorn.player?a():(b(e),f())}window.Popcorn?g():(b(d),c(g))},this.addPlayerType=function(a){if(!Popcorn[a]){var b=document.createElement("script");b.src=f.replace(/\{type\}/g,a),document.head.appendChild(b)}},this.getHTML=function(a){var b=document.createElement("html"),c=document.getElementsByTagName("head")[0].cloneNode(!0),d=document.getElementsByTagName("body")[0].cloneNode(!0),e,f,g,h;g=Array.prototype.slice.call(c.querySelectorAll("*[data-butter-exclude]")),g=g.concat(Array.prototype.slice.call(c.querySelectorAll("*[data-requiremodule]")));for(e=0,l=g.length;e<l;++e)h=g[e],h.parentNode.removeChild(h);f=d.querySelectorAll('*[butter-clean="true"]');for(e=0,l=f.length;e<l;++e)h=f[e],h.removeAttribute("butter-clean"),h.removeAttribute("data-butter"),h.classList?h.classList.remove("ui-droppable"):h.className=h.className.replace(/ui-droppable/g,"");g=d.querySelectorAll("*[data-butter-exclude]");for(e=0,l=g.length;e<l;++e)h=g[e],h.parentNode.removeChild(h);b.appendChild(c),b.appendChild(d);if(a)for(e=0;e<a.length;++e){var i=document.createElement("script");i.type="text/javascript",i.innerHTML="(function(){\n"+a[e]+"\n}());",d.appendChild(i)}return"<html>"+b.innerHTML+"</html>"}}}),c("core/comm",["./eventmanager"],function(a){var b=1,c=function(c,d){function k(){i||(j||e.dispatch("error",{type:"connectionclosed"}),l())}function l(){j=!1,e.send("ping"),setTimeout(k,1e3)}var e=this,f=new a(e),g,h=b++,i=!1,j=!1;c.addEventListener("message",function(a){a.source===c&&typeof a.data=="object"&&a.data.context&&(a.data.type==="pong"?j=!0:e.dispatch(a.data.type,a.data.data))},!1),f.listen("ready",function(a){clearInterval(g),d(),l()}),g=setInterval(function(){e.send("ready","ready")},100),this.send=function(a,b){c.postMessage({type:a,context:h,data:b},"*")},this.destroy=function(){i=!0,clearInterval(g)}};return c}),c("dialog/modal",[],function(){var a;return function(b){a||(a=document.createElement("div"),a.id="butter-modal-container",document.body.appendChild(a));var c=document.createElement("div"),d=this;c.className="layer",b&&typeof b=="string"&&(c.className+=b),a.appendChild(c),setTimeout(function(){c.className+=" fade-in"},10),this.destroy=function(){a.removeChild(c)},Object.defineProperties(this,{element:{enumerable:!0,get:function(){return c}}})}}),c("dialog/iframe-dialog",["core/comm","core/eventmanager","dialog/modal"],function(a,b,c){return function(d){function o(a){g.dispatch(a.type,a.data)}function p(a){g.dispatch(a.type,a.data),e.close()}d=d||{};if(!d.url)throw new Error("IFRAME dialog requires a url.");var e=this,f=d.url,g=new b(e),h=d.parent,i=!1,j,k=[],l,m,n=d.events||{};this.modal=d.modal,this.close=function(){h.removeChild(j),m&&(m.destroy(),m=undefined),l.unlisten("submit",o),l.unlisten("cancel",p),l.unlisten("close",e.close),l.destroy(),i=!1,window.removeEventListener("beforeunload",e.close,!1);for(var a in n)a!=="close"&&g.unlisten(a,n[a]);g.dispatch("close"),g.unlisten("close",n.close)},this.open=function(b){if(i)return;e.modal&&(m=new c(e.modal));for(var d in b)n[d]=b[d];var q=m?m.element:document.body;h=h||q,j=document.createElement("iframe"),j.src=f,j.addEventListener("load",function(b){l=new a(j.contentWindow,function(){l.listen("submit",o),l.listen("cancel",p),l.listen("close",e.close),window.addEventListener("beforeunload",e.close,!1);for(var a in n)g.listen(a,n[a]);while(k.length>0){var b=k.pop();e.send(b.type,b.data)}i=!0,g.dispatch("open")})},!1),h.appendChild(j),setTimeout(function(){j.className+=" fade-in"},10)},this.send=function(a,b){l?l.send(a,b):k.push({type:a,data:b})},Object.defineProperties(this,{iframe:{enumerable:!0,get:function(){return j}},closed:{enumerable:!0,get:function(){return!i}}})}}),c("dialog/window-dialog",["core/comm","core/eventmanager","dialog/modal"],function(a,b,c){var d=640,e=479,f=300;return function(g){function s(a){j.dispatch(a.type,a.data)}function t(a){j.dispatch(a.type,a.data),h.close()}function u(a){a.data.type==="connectionclosed"&&h.close(),j.dispatch("error",a.data)}function v(){l&&l.closed===!0&&h.close()}g=g||{};if(!g.url)throw new Error("Window dialog requires a url.");var h=this,i=g.url,j=new b(h),k,l,m,n,o=[],p=!1,q=["width="+(g.width||d),"height="+(g.height||e),"toolbar=no","menubar=no","titlebar=yes","location=no","resizable=yes"],r=g.events||{};h.modal=g.modal,this.close=function(){m&&(m.destroy(),m=undefined),k.unlisten("submit",s),k.unlisten("cancel",t),k.unlisten("close",h.close),k.destroy(),l.close&&l.close(),clearInterval(n),window.removeEventListener("beforeunload",h.close,!1),k=l=undefined,p=!1;for(var a in r)j.unlisten(a,r[a]);j.dispatch("close")},this.open=function(b){h.modal&&(m=new c(h.modal));for(var d in b)r[d]=b[d];l=window.open(i,"dialog-window:"+i,q.join(",")),window.addEventListener("beforeunload",h.close,!1),k=new a(l,function(){k.listen("error",u),k.listen("submit",s),k.listen("cancel",t),k.listen("close",h.close);for(var a in r)j.listen(a,r[a]);n=setInterval(v,f);while(o.length>0){var b=o.pop();h.send(b.type,b.data)}p=!0,j.dispatch("open")})},this.focus=function(){l.focus()},this.send=function(a,b){k?k.send(a,b):o.push({type:a,data:b})},Object.defineProperties(this,{closed:{enumerable:!0,get:function(){return!p}}})}}),c("editor/editor",["core/eventmanager","dialog/iframe-dialog","dialog/window-dialog","util/time"],function(a,b,c,d){function h(h,i,j,k,l,m){function y(){if(v==="Media Element")h.currentMedia.view.blink();else{var a=h.getTargetByType("elementID",v);a&&a.view.blink()}}function z(a){var b=w.popcornOptions;b.target!==v&&(v=b.target,y()),t.send("trackeventupdated",w.popcornOptions)}function A(a){t.send("trackeventupdatefailed",a.data)}function B(){t=null,w.unlisten("trackeventupdated",z),w.unlisten("trackeventupdatefailed",A),s.dispatch("close")}m=m||{};var n=g++,o=k||f,p=i,q=j,r=e.slice(),s=new a(this),t,u={type:o,modal:"behind-timeline",url:i,parent:l},v,w,x=this;r[0]=m.width||r[0],r[1]=m.height||r[1],this.open=function(a){t||(o==="window"?t=new c(u):t=new b(u));if(!t.closed&&t.focus){t.focus();return}w=a,t.open({open:function(b){var c=[],d={name:h.currentMedia.name,target:h.currentMedia.target};for(var e=0,f=h.targets.length;e<f;e++)c.push(h.targets[e].element.id);var g=a.popcornOptions;t.send("trackeventdata",{manifest:Popcorn.manifest[a.type],popcornOptions:g,targets:c,media:d}),v=g.target,y(),a.listen("trackeventupdated",z),a.listen("trackeventupdatefailed",A),o==="iframe"&&t.iframe.focus(),s.dispatch("open")},submit:function(b){var c=d.roundTime(h.currentMedia.duration),e=b.data.eventData,f=b.data.alsoClose;e&&(a.update(e),f&&t.close())},close:function(a){B()}})},this.close=function(){w&&t&&t.close()},Object.defineProperties(x,{isOpen:{enumerable:!0,get:function(){return!!t}},type:{enumerable:!0,get:function(){return q}},frame:{enumerable:!0,get:function(){return o}},size:{enumerable:!0,get:function(){return{width:r[0],height:r[1]}},set:function(a){a=a||{},r[0]=a.width||r[0],r[1]=a.height||r[1]}}})}var e=[400,400],f="iframe",g=0;return h}),function(){c("editor/module",["core/logger","core/eventmanager","core/trackevent","./editor"],function(a,b,c,d){function e(e,f){function m(a){k.frame==="iframe"&&e.ui.contentState==="editor"&&e.ui.popContentState("editor"),k.unlisten("close",m),k=null}function n(a){k.frame==="iframe"&&e.ui.contentState!=="editor"&&e.ui.pushContentState("editor")}function o(a){l.edit(a.target.trackEvent)}f=f||{};var g={},h=new a("EventEditor"),i=new b(this),j,k,l=this;e.listen("trackeventcreated",function(a){["target","media"].indexOf(a.data.by)>-1&&e.ui.contentState==="timeline"&&l.edit(a.data.trackEvent)}),this.edit=function(a){if(!a||!(a instanceof c))throw new Error("trackEvent must be valid to start an editor.");var b=a.type;g[b]||(b="default");if(!k){var d=g[b];if(d)k=d,d.listen("open",n),d.open(a),d.listen("close",m);else throw new Error("Editor "+b+" not found.")}},this.add=function(a,b,c){if(!b||!a)throw new Error("Can't create an editor without a plugin type and editor source");var f=g[b]=new d(e,a,b,c,j);return f},this.remove=function(a){if(!a)return;var b=g[a];return g[a]=undefined,b},e.listen("trackeventadded",function(a){a.data.view.listen("trackeventdoubleclicked",o,!1)}),e.listen("trackeventremoved",function(a){a.data.view.unlisten("trackeventdoubleclicked",o,!1)}),this._start=function(a){var b=document.createElement("div");b.id="butter-editor",j=document.createElement("div"),j.id="editor-container",b.appendChild(j),b.classList.add("fadable"),e.ui.areas.work.addComponent(b,{states:["editor"],transitionIn:function(){b.style.display="block",setTimeout(function(){b.style.opacity="1"},0)},transitionInComplete:function(){},transitionOut:function(){k&&k.close(),b.style.opacity="0"},transitionOutComplete:function(){b.style.display="none"}}),b.style.display="none";for(var c in f)f.hasOwnProperty(c)&&l.add(f[c],c);a()},e.listen("trackeventeditrequested",function(a){l.edit(a.target)})}return e.__moduleName="editor",e})}(),c("timeline/track-container",["core/logger","core/eventmanager"],function(a,b){return function(a){function g(){f.style.width=b.duration*c+"px"}function h(a){var e=a.data.view;f.appendChild(e.element),e.duration=b.duration,e.zoom=c,e.parent=d}var b=a,c=1,d=this,e=document.createElement("div"),f=document.createElement("div");e.appendChild(f),e.className="tracks-container-wrapper",f.className="tracks-container",f.addEventListener("mousedown",function(a){d.deselectOthers()},!1),this.orderTracks=function(a){for(var b=0,c=a.length;b<c;++b){var d=a[b].view.element;d!==f.childNodes[b]&&(a[b].order=b,f.insertBefore(d,f.childNodes[b+1]))}},this.deselectOthers=function(){for(var a=0;a<butter.selectedEvents.length;a++)butter.selectedEvents[a].selected=!1;return butter.selectedEvents=[],d},b.listen("mediaready",function(){g();var a=b.tracks;for(var d=0,e=a.length;d<e;++d){var h=a[d].view;f.appendChild(h.element),h.duration=b.duration,h.zoom=c}});var i=b.tracks;for(var j=0;j<i.length;++j)h({data:i[j]});b.listen("trackadded",h),b.listen("trackremoved",function(a){var b=a.data.view;f.removeChild(b.element)}),Object.defineProperties(this,{zoom:{enumerable:!0,get:function(){return c},set:function(a){c=a,g();var d=b.tracks;for(var e=0,f=d.length;e<f;++e)d[e].view.zoom=c}},element:{enumerable:!0,get:function(){return e}},width:{enumerable:!0,get:function(){return e.getBoundingClientRect().width}},height:{enumerable:!0,get:function(){return e.getBoundingClientRect().height}},scrollWidth:{enumerable:!0,get:function(){return e.scrollWidth}},scrollHeight:{enumerable:!0,get:function(){return e.scrollHeight}},vScroll:{enumerable:!0,get:function(){return e.scrollTop/e.scrollHeight},set:function(a){e.scrollTop=e.scrollHeight*a}},hScroll:{enumerable:!0,get:function(){return e.scrollLeft/e.scrollWidth},set:function(a){e.scrollLeft=e.scrollWidth*a}},container:{enumerable:!0,get:function(){return f}}})}}),c("timeline/scrollbars",["core/eventmanager"],function(a){function c(c){function q(){j=g.getBoundingClientRect().height,k=h.getBoundingClientRect().height,i=d.getBoundingClientRect().height,l=h.scrollHeight,m=i-(l-j)/b,m=Math.max(20,Math.min(i,m)),e.style.height=m+"px",u()}function r(){window.removeEventListener("mouseup",r,!1),window.removeEventListener("mousemove",s,!1),e.addEventListener("mousedown",t,!1)}function s(a){var b=a.pageY-n;b=Math.max(0,Math.min(b,i-m)),e.style.top=b+"px";var c=e.offsetTop/(i-m);g.scrollTop=(l-i)*c,o.dispatch("scroll",g.scrollTop)}function t(a){if(a.button===0){var b=e.offsetTop;n=a.pageY-b,window.addEventListener("mouseup",r,!1),window.addEventListener("mousemove",s,!1),e.removeEventListener("mousedown",t,!1)}}function u(){h.scrollHeight-i>0?e.style.top=(i-m)*(g.scrollTop/(h.scrollHeight-i))+"px":e.style.top="0px"}var d=document.createElement("div"),e=document.createElement("div"),f=c,g=c.element,h=c.container,i,j,k,l,m,n=0,o=new a(this),p=this;d.className="scroll-bar scroll-bar-v",e.className="scroll-handle",d.appendChild(e),this.update=function(){q()},g.addEventListener("scroll",function(a){u()},!1),g.addEventListener("mousewheel",function(a){a.wheelDeltaY&&(g.scrollTop-=a.wheelDeltaY,u(),a.preventDefault())},!1),g.addEventListener("DOMMouseScroll",function(a){a.axis===a.VERTICAL_AXIS&&!a.shiftKey&&(g.scrollTop+=a.detail*2,u(),a.preventDefault())},!1),d.addEventListener("click",function(a){if(a.srcElement===e||a.button>0)return;var b=a.pageY,c=e.getBoundingClientRect(),f=d.getBoundingClientRect(),h;b>c.bottom?e.style.top=b-f.top-m+"px":b<c.top&&(e.style.top=b-f.top+"px"),h=e.offsetTop/(i-m),g.scrollTop=(l-i)*h},!1),window.addEventListener("resize",q,!1),e.addEventListener("mousedown",t,!1),q(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return d}}})}function d(b){function p(){i=f.getBoundingClientRect().width,j=g.getBoundingClientRect().width,h=c.getBoundingClientRect().width,k=g.scrollWidth,l=h-(k-i),l=Math.max(20,Math.min(h,l)),d.style.width=l+"px",t()}function q(){window.removeEventListener("mouseup",q,!1),window.removeEventListener("mousemove",r,!1),d.addEventListener("mousedown",s,!1)}function r(a){var b=a.pageX-m;b=Math.max(0,Math.min(b,h-l)),d.style.left=b+"px";var c=d.offsetLeft/(h-l);f.scrollLeft=(k-h)*c,n.dispatch("scroll",f.scrollLeft)}function s(a){if(a.button===0){var b=d.offsetLeft;m=a.pageX-b,window.addEventListener("mouseup",q,!1),window.addEventListener("mousemove",r,!1),d.removeEventListener("mousedown",s,!1)}}function t(){k-h>0?d.style.left=(h-l)*(f.scrollLeft/(k-h))+"px":d.style.left="0px"}var c=document.createElement("div"),d=document.createElement("div"),e=b,f=b.element,g=b.container,h,i,j,k,l,m=0,n=new a(this),o=this;c.className="scroll-bar scroll-bar-h",d.className="scroll-handle",c.appendChild(d),f.addEventListener("scroll",function(a){t()},!1),g.addEventListener("mousewheel",function(a){a.wheelDeltaX&&(f.scrollLeft-=a.wheelDeltaX,t(),a.preventDefault())},!1),g.addEventListener("DOMMouseScroll",function(a){if(a.axis===a.HORIZONTAL_AXIS||a.axis===a.VERTICAL_AXIS&&a.shiftKey)f.scrollLeft+=a.detail*2,t(),a.preventDefault()},!1),c.addEventListener("click",function(a){if(a.srcElement===d||a.button>0)return;var b=a.pageX,e=d.getBoundingClientRect(),g=c.getBoundingClientRect(),i;b>e.right?d.style.left=b-g.left-l+"px":b<e.left&&(d.style.left=b-g.left+"px"),i=d.offsetLeft/(h-l),f.scrollLeft=(k-h)*i},!1),window.addEventListener("resize",p,!1),d.addEventListener("mousedown",s,!1),this.update=function(){p()},p(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return c}}})}var b=3;return{Vertical:c,Horizontal:d}}),c("timeline/scrubber",[],function(){var a=50,b=16,c=20,d=3;return function(e,f,g,h,i){function F(){var a=q.duration,b=q.currentTime,c=n.element.scrollLeft;if(A!==b||B!==c||C!==t){var d=b/a*o,e=d-c;d<c||Math.floor(d)-D>x+c?k.style.display="none":(k.style.left=e+"px",k.style.display="block"),d<c?m.style.display="none":(d>x+c?m.style.width=x-2+"px":m.style.width=e+"px",m.style.display="block")}A=b,B=c,C=t}function G(a){y&&(q.play(),z=!1),clearInterval(u),u=-1,window.removeEventListener("mouseup",G,!1),window.removeEventListener("mousemove",J,!1)}function H(a){a==="right"?u=setInterval(function(){s<v.right-d?(clearInterval(u),u=-1):(s+=c,n.element.scrollLeft+=c,I(),F())},b):u=setInterval(function(){s>v.left+d?(clearInterval(u),u=-1):(s-=c,n.element.scrollLeft-=c,I(),F())},b)}function I(){var a=s-r;a=Math.max(0,Math.min(a,x)),q.currentTime=(a+n.element.scrollLeft)/o*q.duration}function J(a){s=a.pageX,u===-1&&(s>v.right-d?H("right"):s<v.left+d&&H("left")),I(),F()}function K(a){r=a.pageX-k.offsetLeft,y&&(q.pause(),z=!0),k.removeEventListener("mousedown",K,!1),window.addEventListener("mousemove",J,!1),window.addEventListener("mouseup",G,!1)}function M(){F()}var j=document.createElement("div"),k=document.createElement("div"),l=document.createElement("div"),m=document.createElement("div"),n=h,o,p=f,q=g,r,s,t=1,u=-1,v,w,x,y=!1,z=!1,A=-1,B=n.element.scrollLeft,C=-1,D=0,E=this;j.className="time-bar-scrubber-container",k.className="time-bar-scrubber-node",l.className="time-bar-scrubber-line",m.className="fill-bar",k.appendChild(l),j.appendChild(m),j.appendChild(k),p.appendChild(j),e.ui.registerStateToggleFunctions("timeline",{transitionIn:function(){l.removeAttribute("data-butter-shortened")},transitionOut:function(){l.setAttribute("data-butter-shortened",!0)}}),i.listen("scroll",F);var L=this.onMouseDown=function(a){var b=a.pageX-j.getBoundingClientRect().left;q.currentTime=(b+n.element.scrollLeft)/o*q.duration,F(),K(a)};k.addEventListener("mousedown",K,!1),j.addEventListener("mousedown",L,!1),this.update=function(a,b){t=b||t,x=a,o=n.container.getBoundingClientRect().width,j.style.width=x+"px",v=j.getBoundingClientRect(),D=l.clientWidth,F()},window.addEventListener("resize",E.update,!1),q.listen("mediaplaying",function(a){y=!0}),q.listen("mediapause",function(a){z||(y=!1)}),_checkMediaInterval=setInterval(M,a),this.destroy=function(){clearInterval(_checkMediaInterval)}}}),c("timeline/timebar",["util/lang","./scrubber"],function(a,b){var c=5;return function(d,e,f,g){function o(b){var d=f.container.getBoundingClientRect().width,e=Math.min(d,l.container.scrollWidth),g=Math.min(e,l.element.offsetWidth-c);j.style.width=g+"px";var h=i.getContext("2d");i.height!=i.offsetHeight&&(i.height=i.offsetHeight),i.width!=g&&(i.width=g);var n=l.container.scrollWidth/k.duration,o=h.measureText(a.secondsToSMPTE(5)).width,p=20,q=0,r=-((o+p)/2),s=l.element.scrollLeft/n,t=(l.element.scrollLeft+g)/n;h.clearRect(0,0,i.width,i.height),h.translate(-l.element.scrollLeft,0),h.beginPath();for(var u=1,v=k.duration+1;u<v;u++){if(u+1<s)continue;if(u-1>t)break;var w=u*n,x=-~w+~q;x>3&&(x>6&&(h.moveTo(-~w-x/2,0),h.lineTo(-~w-x/2,7),x>12&&(h.moveTo(-~w-x/4*3,0),h.lineTo(-~w-x/4*3,4),h.moveTo(-~w-x/4,0),h.lineTo(-~w-x/4,4))),h.moveTo(-~w,0),h.lineTo(-~w,10),w-r>o+p&&(r=w,h.fillStyle="#999999",h.fillText(a.secondsToSMPTE(u),-~w-o/2,21)),q=w)}h.strokeStyle="#999999",h.stroke(),h.translate(l.element.scrollLeft,0),m.update(g,b)}var h=document.createElement("div"),i=document.createElement("canvas"),j=document.createElement("div"),k=e,l=f,m=new b(d,h,k,l,g),n=this;h.className="time-bar",j.className="time-bar-canvas-container",j.appendChild(i),h.appendChild(j),i.addEventListener("mousedown",m.onMouseDown,!1),l.element.addEventListener("scroll",function(){o()},!1),this.update=function(a){o(a)},this.destroy=function(){m.destroy()},Object.defineProperties(this,{element:{enumerable:!0,get:function(){return h}}})}}),c("timeline/zoombar",[],function(){var a=6;return function(b){function j(){window.removeEventListener("mouseup",j,!1),window.removeEventListener("mousemove",k,!1),d.addEventListener("mousedown",l,!1),b(d.offsetLeft/e.width)}function k(a){var c=a.pageX-f;c=Math.max(0,Math.min(c,h-g)),d.style.left=c+"px",b(d.offsetLeft/e.width)}function l(a){if(a.button===0){var b=d.offsetLeft;f=a.pageX-b,window.addEventListener("mouseup",j,!1),window.addEventListener("mousemove",k,!1),d.removeEventListener("mousedown",l,!1)}}var c=document.createElement("div"),d=document.createElement("div"),e,f,g,h,i=this;c.className="zoom-bar scroll-bar",d.className="scroll-handle",c.appendChild(d),d.addEventListener("mousedown",l,!1),this.update=function(b){e=c.getBoundingClientRect(),d.style.width=e.width/a+"px",g=e.width/a,h=e.width,b!==undefined&&(d.style.left=b*e.width/a+"px")},c.addEventListener("click",function(a){if(a.srcElement===d)return;var b=a.pageX,e=d.getBoundingClientRect(),f=c.getBoundingClientRect(),h;b>e.right?d.style.left=b-f.left-g+"px":d.style.left=b-f.left+"px",k(a)},!1),c.addEventListener("resize",function(a){i.update()},!1),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return c}}})}}),c("timeline/status",[],function(){function a(a,b){function g(){f?e.removeAttribute("state"):e.setAttribute("state",!0)}function h(a){d.removeAttribute("mouse-state"),window.removeEventListener("mouseup",h,!1)}var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div"),f=!0;c.className=a,d.className="status-button",e.className="status-button-icon",c.appendChild(d),d.appendChild(e),d.addEventListener("mousedown",function(a){d.setAttribute("mouse-state","depressed"),window.addEventListener("mouseup",h,!1)},!1),d.addEventListener("click",b,!1),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return c}},state:{enumerable:!0,get:function(){return f},set:function(a){f=a,g()}}})}function b(a){function h(a,b){if(typeof a=="string"||!isNaN(a)){if(b)try{d.currentTime=Popcorn.util.toSeconds(a)}catch(f){a=d.currentTime}var g=new Date(1970,0,1),h;g.setSeconds(a),h=g.toTimeString().substr(0,8),h>86399&&(h=Math.floor((g-Date.parse("1/1/70"))/36e5)+h.substr(2)),c.value=h}else c.value=e}var b=document.createElement("div"),c=document.createElement("input"),d=a,e=0,f=this;b.className="time-container",b.appendChild(c),c.type="text";var g=/[^0123456789:\.]/;d.listen("mediatimeupdate",function(a){h(d.currentTime,!1)}),c.addEventListener("focus",function(a){e=c.value},!1),c.addEventListener("blur",function(a){c.value!==e&&h(c.value,!0)},!1),c.addEventListener("keydown",function(a){a.which===13?c.blur():a.which===27&&(c.value=e,c.blur())},!1),h(0,!1),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return b}}})}return function(c){var d=c,e=document.createElement("div"),f,g,h,i=this;e.className="status-container",h=new b(d),f=new a("mute-button-container",function(a){d.muted=!d.muted}),g=new a("play-button-container",function(a){d.ended?d.paused=!1:d.paused=!d.paused}),d.listen("mediamuted",function(a){f.state=!1}),d.listen("mediaunmuted",function(a){f.state=!0}),d.listen("mediavolumechange",function(a){f.state=!d.muted}),d.listen("mediaended",function(a){g.state=!0}),d.listen("mediaplaying",function(a){g.state=!1}),d.listen("mediapause",function(a){g.state=!0}),e.appendChild(h.element),e.appendChild(g.element),i.update=function(){},i.destroy=function(){},Object.defineProperties(this,{statusElement:{enumerable:!0,get:function(){return e}},muteElement:{enumerable:!0,get:function(){return f.element}}})}}),c("timeline/trackhandles",["dialog/iframe-dialog","util/dragndrop"],function(a,b){var c=35;return function(d,e,f,g){function r(b){var d=b.data,f=d.id,g=d.name,h=document.createElement("div"),i=document.createElement("div"),n=document.createElement("div"),p=document.createElement("div");i.className="menu",n.className="delete",i.appendChild(n),n.addEventListener("click",function(b){var c=new a({type:"iframe",modal:!0,url:"../dialogs/delete-track.html",events:{open:function(a){c.send("trackdata",g)},submit:function(a){a.data===!0&&e.removeTrack(d),c.close()},cancel:function(a){c.close()},trackupdated:function(a){c.send("trackupdated",{success:!1})}}});c.trackupdated=function(a){console.log("called",a)},c.open()},!1),h.addEventListener("dblclick",function(b){var c=new a({type:"iframe",modal:!0,url:"../dialogs/track-data.html",events:{open:function(a){c.send("trackdata",d.json)},submit:function(a){try{var b=JSON.parse(a.data),e=d.trackEvents,f=b.trackEvents,g={},h=[],i,j;for(i=0,j=f.length;i<j;i++){var k=f[i],l=d.getTrackEventById(k.id);l?(l.update(k.popcornOptions),g[k.id]=k):h.push({type:k.type,popcornOptions:k.popcornOptions})}for(i=e.length,j=0;i>=j;i--)e[i]&&!g[e[i].id]&&d.removeTrackEvent(e[i]);for(i=0,j=h.length;i<j;i++)d.addTrackEvent(h[i]);c.send("trackupdated",!0)}catch(m){console.log(m),c.send("trackupdated",!1)}}}});c.open()},!1),m.push(i),h.className="track-handle",h.id="track-handle-"+f,h.setAttribute("data-butter-track-id",f),h.appendChild(document.createTextNode(g)),h.appendChild(i),o.addItem(h),j.appendChild(h),l[f]={id:f,track:d,element:h,menu:i},k.style.top=j.offsetHeight-c+"px"}var h=e,i=document.createElement("div"),j=document.createElement("div"),k=document.createElement("button"),l={},m=[],n=this;i.className="track-handle-container",j.className="handle-list",i.appendChild(j),k.id="add-track",k.innerHTML="+Track",i.appendChild(k),k.addEventListener("click",function(a){d.currentMedia.addTrack()},!1);var o=b.sortable(j,{change:function(a){var b=[];for(var c=0,d=a.length;c<d;++c){var e=a[c].getAttribute("data-butter-track-id");b.push(l[e].track)}g(b)}}),p=h.tracks;for(var q=0;q<p.length;++q)r({data:p[q]});h.listen("trackadded",r),h.listen("trackremoved",function(a){var b=a.data.id;j.removeChild(l[b].element),o.removeItem(l[b].element),m.splice(m.indexOf(l[b].menu),1),delete l[b],k.style.top=j.offsetHeight-c+"px"}),f.element.addEventListener("scroll",function(a){i.scrollTop=f.element.scrollTop},!1),this.update=function(){i.scrollTop=f.element.scrollTop,k.style.top=j.offsetHeight-c+"px"},n.update(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return i}}})}}),c("timeline/media",["core/trackevent","core/track","core/eventmanager","./track-container","./scrollbars","./timebar","./zoombar","./status","./trackhandles"],function(a,b,c,d,e,f,g,h,i){function l(a,b){function G(a){o.orderTracks(a)}function H(a){var b=(1+a)*k;b!==F&&(F=b,o.zoom=F,Q())}function I(b){b!=="Media Element"?(b=a.getTargetByType("elementID",b),b&&b.view.blink()):m.view.blink()}function J(a){var b=a.trackEvent,c=b.popcornOptions;c.target&&I(c.target)}function K(a){}function L(a){if(E&&D==="click"){var b=E.popcornOptions;b.target&&I(b.target)}}function M(a){E=null}function N(b){var c=b.data.trackEvent,d=b.data.originalEvent;E=c;if(c.selected===!0&&d.shiftKey&&u.length>1)c.selected=!1;else{c.selected=!0;if(!d.shiftKey){var e=m.tracks;for(var f in e)e.hasOwnProperty(f)&&e[f].deselectEvents(c);a.selectedEvents=[c]}else a.selectedEvents.push(c)}}function O(b){var c=b.data.type,d=b.data.track,e=b.data.start;e+1>m.duration&&(e=m.duration-1);var f=a.defaultTarget;!f&&a.targets.length>0&&(f=a.targets[0]);var g=d.addTrackEvent({popcornOptions:{start:e,end:e+1,target:f.elementID},type:c});f&&f.view.blink()}function P(a){var b=m.findTrackWithTrackEventId(a.data.trackEvent),c=b.trackEvent,d=c.popcornOptions;b.track.removeTrackEvent(c);var e=d.end-d.start;d.start=a.data.start,d.end=d.start+e,c.update(d),a.data.track.addTrackEvent(c)}function Q(){m.duration&&(z.update(F),w.update(),x.update(),A.update(),C.update())}var l=this,m=b,n=new c(this),o=new d(b),p=document.createElement("div"),q=document.createElement("div"),r=document.createElement("div"),s,t={},u=[],v=!1,w=new e.Horizontal(o),x=new e.Vertical(o),y=!1,z=new f(a,m,o,w),A=new g(H),B=new h(m),C=new i(a,m,o,G),D=a.config.ui.trackEventHighlight||"click",E,F=j;p.className="media-instance",p.id="media-instance"+b.id,q.className="media-container",r.className="media-status-container",m.listen("trackeventselected",function(a){u.push(a.target)}),m.listen("trackeventdeselected",function(a){u.splice(u.indexOf(a.target),1)}),m.listen("mediaready",function(){function c(a){x.update();var b=a.data;b.view.listen("plugindropped",O),b.view.listen("trackeventdropped",P),b.view.listen("trackeventmousedown",N),D==="hover"&&(b.view.listen("trackeventmouseover",J),b.view.listen("trackeventmouseout",K))}A.update(0),o.zoom=F;var b=m.tracks;q.appendChild(o.element),q.appendChild(w.element),q.appendChild(x.element),r.appendChild(z.element),r.appendChild(B.statusElement),r.appendChild(B.muteElement),a.ui.areas.statusbar.element.appendChild(r),p.appendChild(C.element),p.appendChild(A.element),p.appendChild(q),m.listen("trackeventadded",function(a){var b=a.data;b.view.listen("trackeventdragstarted",M),b.view.listen("trackeventmouseup",L),b.view.listen("trackeventmousedown",N),D==="hover"&&(b.view.listen("trackeventmouseover",J),b.view.listen("trackeventmouseout",K))}),m.listen("trackeventremoved",function(a){var b=a.data;b.view.unlisten("trackeventdragstarted",M),b.view.unlisten("trackeventmouseup",L),b.view.unlisten("trackeventmousedown",N),D==="hover"&&(b.view.unlisten("trackeventmouseover",J),b.view.unlisten("trackeventmouseout",K))});var d=m.tracks;for(var e=0;e<d.length;++e)c({data:d[e]});m.listen("trackadded",c),m.listen("trackremoved",function(a){x.update();var b=a.data;b.view.unlisten("plugindropped",O),b.view.unlisten("trackeventdropped",P),b.view.listen("trackeventmousedown",N),D==="hover"&&(b.view.listen("trackeventmouseover",J),b.view.listen("trackeventmouseout",K))}),Q(),v=!0,n.dispatch("ready")}),this.destroy=function(){p.parentNode.removeChild(p),r.parentNode&&a.ui.areas.statusbar.element.removeChild(r),z.destroy()},this.hide=function(){p.style.display="none"},this.show=function(){p.style.display="block"},o.zoom=F,Object.defineProperties(this,{zoom:{enumerable:!0,get:function(){return F},set:function(a){F=a,Q()}},element:{enumerable:!0,configurable:!1,get:function(){return p}},media:{enumerable:!0,configurable:!1,get:function(){return m}},initialized:{enumerable:!0,configurable:!1,get:function(){return v}},shrunken:{enumerable:!0,configurable:!1,get:function(){return y},set:function(a){a!==y&&(y=a)}}})}var j=100,k=100;return l}),c("timeline/module",["core/logger","./media"],function(a,b){var c=function(a,c){var d={},e,f=document.createElement("div");f.id="butter-timeline",f.classList.add("fadable"),this._start=function(b){a.ui.areas.work.addComponent(f,{states:["timeline"],transitionIn:function(){f.style.display="block",setTimeout(function(){f.style.opacity="1"},0)},transitionInComplete:function(){},transitionOut:function(){f.style.opacity="0"},transitionOutComplete:function(){f.style.display="none"}}),a.ui.registerStateToggleFunctions("timeline",{transitionIn:function(){f.removeAttribute("data-butter-disabled")},transitionOut:function(){f.setAttribute("data-butter-disabled",!0)}}),a.ui.pushContentState("timeline"),b()},a.ui&&a.ui.listen("uivisibilitychanged",function(a){for(var b in d)d.hasOwnProperty(b)&&(d[b].shrunken=!a.data)}),this.findAbsolutePosition=function(a){var b=0,c=0;if(a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return[b,c]},a.listen("mediaadded",function(c){function i(b){a.dispatch("timelineready")}function j(b){e!==d[b.data.id]&&(e&&e.hide(),e=d[b.data.id],e&&e.show(),a.dispatch("timelineready"))}function k(b){var c=b.data;d[c.id]&&d[c.id].destroy(),delete d[c.id],e&&c.id===e.media.id&&(e=undefined),a.unlisten("mediachanged",j),a.unlisten("mediaremoved",k)}var g=c.data,h=new b(a,g);d[g.id]=h,f.appendChild(h.element),a.listen("mediachanged",j),a.listen("mediaremoved",k)}),Object.defineProperties(this,{zoom:{get:function(){return _currentMediaInstace.zoom},set:function(a){e.zoom=a}}})};return c.__moduleName="timeline",c}),function(){function a(a){var b=[];for(var c in a)b[b.length]=encodeURIComponent(c)+"="+encodeURIComponent(a[c]);return b.join("&").replace("/%20/g","+")}var b={form:"application/x-www-form-urlencoded",json:"application/json"};c("util/xhr",[],function(){var c={get:function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.onreadystatechange=b,c.send(null)},post:function(c,d,e,f){var g=new XMLHttpRequest;g.open("POST",c,!0),g.onreadystatechange=e,!f||f==="form"?(g.setRequestHeader("Content-Type",b.form),g.send(a(d))):b[f]?(g.setRequestHeader("Content-Type",b[f]),g.send(d)):(g.setRequestHeader("Content-Type","text/plain"),g.send(d))}};return c})}(),c("cornfield/module",["util/xhr"],function(a){function b(){return location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}var c=function(c,d){var e=null,f=d.server,g=d.authType||"browserid";if(g==="browserid"&&!navigator.id){var h=document.createElement("script");h.src="https://browserid.org/include.js",h.type="text/javascript",h.setAttribute("data-butter-exlude",!0),document.head.appendChild(h)}this.login=function(c){navigator.id.get(function(d){d?a.post(f+"/browserid/verify",{audience:b(),assertion:d},function(){if(this.readyState===4)try{var a=JSON.parse(this.response);a.status==="okay"&&(e=a.email),c(a)}catch(b){c({error:"an unknown error occured"})}}):c(undefined)})},this.user=function(){return e},this.publish=function(b,c){a.post(f+"/publish/"+b,null,function(){if(this.readyState===4)try{var a=JSON.parse(this.response);c(a)}catch(b){c({error:"an unknown error occured"})}})},this.logout=function(b){a.get(f+"/browserid/logout",function(){e=null;if(this.readyState===4)try{var a=JSON.parse(this.response);b(a)}catch(c){b({error:"an unknown error occured"})}})},this.list=function(b){a.get(f+"/projects",function(){if(this.readyState===4)try{var a=JSON.parse(this.response);b(a)}catch(c){b({error:"an unknown error occured"})}})},this.refreshLoad=function(a){window.location=f+"/load/"+a},this.load=function(b,c){a.get(f+"/project/"+b,function(){if(this.readyState===4)try{var a=JSON.parse(this.response);c(a)}catch(b){c({error:"an unknown error occured"})}})},this.save=function(b,c){a.post(f+"/project/",b,function(){if(this.readyState===4)try{var a=JSON.parse(this.response);c(a)}catch(b){c({error:"an unknown error occured"})}})},this.saveas=function(b,c,d){a.post(f+"/project/"+b,c,function(){if(this.readyState===4)try{var a=JSON.parse(this.response);d(a)}catch(b){d({error:"an unknown error occured"})}},"json")}};return c.__moduleName="cornfield",c}),c("util/scrollbars",["core/eventmanager"],function(a){function c(c,d){function o(){h=c.getBoundingClientRect().height,i=d.getBoundingClientRect().height,g=e.getBoundingClientRect().height,j=d.scrollHeight,k=g-(j-h)/b,k=Math.max(20,Math.min(g,k)),f.style.height=k+"px",s()}function p(){window.removeEventListener("mouseup",p,!1),window.removeEventListener("mousemove",q,!1),f.addEventListener("mousedown",r,!1)}function q(a){var b=a.pageY-l;b=Math.max(0,Math.min(b,g-k)),f.style.top=b+"px";var c=f.offsetTop/(g-k);d.scrollTop=(j-g)*c,m.dispatch("scroll",d.scrollTop)}function r(a){if(a.button===0){var b=f.offsetTop;l=a.pageY-b,window.addEventListener("mouseup",p,!1),window.addEventListener("mousemove",q,!1),f.removeEventListener("mousedown",r,!1)}}function s(){d.scrollHeight-g>0?f.style.top=(g-k)*(d.scrollTop/(d.scrollHeight-g))+"px":f.style.top="0px"}var e=document.createElement("div"),f=document.createElement("div"),g,h,i,j,k,l=0,m=new a(this),n=this;e.className="scroll-bar scroll-bar-v",f.className="scroll-handle",e.appendChild(f),this.update=function(){o()},d.addEventListener("scroll",function(a){s()},!1),d.addEventListener("mousewheel",function(a){a.wheelDeltaY&&(c.scrollTop-=a.wheelDeltaY,s(),a.preventDefault())},!1),d.addEventListener("DOMMouseScroll",function(a){a.axis===a.VERTICAL_AXIS&&!a.shiftKey&&(d.scrollTop+=a.detail*2,s(),a.preventDefault())},!1),e.addEventListener("click",function(a){if(a.srcElement===f||a.button>0)return;var b=a.pageY,c=f.getBoundingClientRect(),h=e.getBoundingClientRect(),i;b>c.bottom?f.style.top=b-h.top-k+"px":b<c.top&&(f.style.top=b-h.top+"px"),i=f.offsetTop/(g-k),d.scrollTop=(j-g)*i},!1),window.addEventListener("resize",o,!1),f.addEventListener("mousedown",r,!1),o(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return e}}})}function d(b,c){function n(){g=b.getBoundingClientRect().width,h=c.getBoundingClientRect().width,f=d.getBoundingClientRect().width,i=c.scrollWidth,j=f-(i-g),j=Math.max(20,Math.min(f,j)),e.style.width=j+"px",r()}function o(){window.removeEventListener("mouseup",o,!1),window.removeEventListener("mousemove",p,!1),e.addEventListener("mousedown",q,!1)}function p(a){var b=a.pageX-k;b=Math.max(0,Math.min(b,f-j)),e.style.left=b+"px";var d=e.offsetLeft/(f-j);c.scrollLeft=(i-f)*d,l.dispatch("scroll",c.scrollLeft)}function q(a){if(a.button===0){var b=e.offsetLeft;k=a.pageX-b,window.addEventListener("mouseup",o,!1),window.addEventListener("mousemove",p,!1),e.removeEventListener("mousedown",q,!1)}}function r(){i-f>0?e.style.left=(f-j)*(c.scrollLeft/(i-f))+"px":e.style.left="0px"}var d=document.createElement("div"),e=document.createElement("div"),f,g,h,i,j,k=0,l=new a(this),m=this;d.className="scroll-bar scroll-bar-h",e.className="scroll-handle",d.appendChild(e),c.addEventListener("scroll",function(a){r()},!1),c.addEventListener("mousewheel",function(a){a.wheelDeltaX&&(c.scrollLeft-=a.wheelDeltaX,r(),a.preventDefault())},!1),c.addEventListener("DOMMouseScroll",function(a){if(a.axis===a.HORIZONTAL_AXIS||a.axis===a.VERTICAL_AXIS&&a.shiftKey)c.scrollLeft+=a.detail*2,r(),a.preventDefault()},!1),d.addEventListener("click",function(a){if(a.srcElement===e||a.button>0)return;var b=a.pageX,g=e.getBoundingClientRect(),h=d.getBoundingClientRect(),k;b>g.right?e.style.left=b-h.left-j+"px":b<g.left&&(e.style.left=b-h.left+"px"),k=e.offsetLeft/(f-j),c.scrollLeft=(i-f)*k},!1),window.addEventListener("resize",n,!1),e.addEventListener("mousedown",q,!1),this.update=function(){n()},n(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return d}}})}var b=3;return{Vertical:c,Horizontal:d}}),c("plugin/plugin-list",["util/dragndrop"],function(a){return function(b){var c=document.createElement("div"),d=document.createElement("div");c.id="plugin-list",d.className="container",c.appendChild(d),b.ui.areas.work.addComponent(c,{states:["add-popcorn"],transitionIn:function(){c.style.display="block",setTimeout(function(){c.style.opacity="1"},0)},transitionOut:function(){c.style.opacity="0"},transitionInComplete:function(){},transitionOutComplete:function(){c.style.display="none"}}),b.listen("pluginadded",function(c){var e=document.createElement("div");e.innerHTML=c.data.type,a.helper(e,{image:c.data.helper,start:function(){var a=b.targets,c=b.currentMedia;c.view.blink();for(var d=0,e=a.length;d<e;++d)a[d].view.blink()},stop:function(){}}),e.setAttribute("data-butter-plugin-type",c.data.type),e.setAttribute("data-butter-draggable-type","plugin"),d.appendChild(e)}),c.style.display="none",c.classList.add("fadable")}}),c("plugin/plugin",["util/dragndrop"],function(a){var b="butter-plugin-";return function(c,d){d=d||{};var e="plugin"+c,f=this,g=d.name||"Plugin"+Date.now(),h=d.path,i={},j=d.type,k;if(h){var l=document.getElementsByTagName("HEAD")[0],m=document.createElement("script");m.src=h,l.appendChild(m)}Object.defineProperties(this,{id:{enumerable:!0,get:function(){return e}},name:{enumerable:!0,get:function(){return g}},path:{enumerable:!0,get:function(){return h}},manifest:{enumerable:!0,get:function(){return i},set:function(a){i=a}},type:{enumerable:!0,get:function(){return j}},helper:{enumerable:!0,get:function(){return _helper}}}),this.createElement=function(c){var d;if(!c)d=document.createElement("span"),d.innerHTML=f.type+" ";else{var e=c.replace(/\$type/g,f.type),g=document.createRange();g.selectNode(document.body.children[0]),d=g.createContextualFragment(e).childNodes[0]}return d.id=b+f.type,_helper=document.getElementById(f.type+"-icon")||document.getElementById("default-icon"),d.setAttribute("data-butter-plugin-type",f.type),d.setAttribute("data-butter-draggable-type","plugin"),a.helper(d,{image:_helper,start:function(){var a=butter.targets,b=butter.currentMedia;b.view.blink();for(var c=0,d=a.length;c<d;++c)a[c].view.blink()},stop:function(){}}),this.element=d,d}}}),function(){c("plugin/module",["core/logger","core/eventmanager","util/dragndrop","util/scrollbars","./plugin-list","./plugin"],function(a,b,c,d,e,f){function k(a){var b=0,c=0,d=0,e=a;while(e.length<9)e+=a;b=(e.charCodeAt(0)+e.charCodeAt(3)+e.charCodeAt(6))%(e.charCodeAt(8)*5%360),c=(e.charCodeAt(0)+e.charCodeAt(2)+e.charCodeAt(4)+e.charCodeAt(6))%100*.05+95,d=(e.charCodeAt(1)+e.charCodeAt(3)+e.charCodeAt(5)+e.charCodeAt(7))%100*.2+40;if(b<20||b>340)d+=10;return b>160&&b<200&&(d-=10),{h:b,s:c,l:d}}function l(a){var b=j.innerHTML,c=k(a);b+=i+"["+h+'="'+a+'"]{',b+="background: hsl( "+c.h+", "+c.s+"%, "+c.l+"% )",b+="}",j.innerHTML=b}var g={},h="data-butter-trackevent-type",i="#butter-timeline .butter-track-event",j=document.createElement("style");j.type="text/css",j.media="screen",j.setAttribute("data-butter-exclude","true");var m=function(a,b){var c=[],h=document.createElement("div"),i=document.createElement("div"),k=this,m='<div class="list-item $type_tool">$type</div>';h.id="butter-plugin",i.className="list";var n=document.createElement("div");n.className="title",n.innerHTML="<span>My Events</span>",h.appendChild(n),h.appendChild(i);var o=new d.Vertical(h,i);h.appendChild(o.element),document.head.appendChild(j),this._start=function(c){a.ui&&(a.ui.areas.tools.addComponent(h),e(a)),b&&b.plugins?k.add(b.plugins,c):c()},this.add=function(b,d){if(b instanceof Array){var e=0,h=0,j=0,n=function(){++e===b.length&&d&&d()};for(h=0,j=b.length;h<j;h++)k.add(b[h],n)}else{g[b.type]||l(b.type),b=new f(c.length,b);var p=setInterval(function(a){if(!Popcorn.manifest[b.type])return;b.manifest=Popcorn.manifest[b.type],clearInterval(p),d&&d()},100);c.push(b),i.appendChild(b.createElement(m)),a.dispatch("pluginadded",b)}return o.update(),b},this.remove=function(b){if(typeof b=="string"){b=this.get(b);if(!b)return}var d,e;for(d=0,e=c.length;d<e;d++)if(c[d].name===b.name){var f=a.tracks;for(d=0,e=f.length;d<e;d++){var g=f[d].trackEvents;for(var h=0,j=g.length-1;j>=h;j--)g[j].type===b.name&&f[d].removeTrackEvent(g[j])}c.splice(d,1),e--,i.removeChild(b.element);var k=document.getElementsByTagName("HEAD")[0];for(d=0,e=k.children.length;d<e;d++)k.children[d].getAttribute("src")===b.path&&k.removeChild(k.children[d]);a.dispatch("pluginremoved",b)}o.update()},this.clear=function(){while(plugins.length>0){var b=c.pop();i.removeChild(b.element),a.dispatch("pluginremoved",b)}},this.get=function(a){for(var b=0,d=c.length;b<d;++b)if(c[b].name===a)return c[b]}};return m.__moduleName="plugin",m})}(),c("ui/toggler",[],function(){return function(a,b){var c=a,d=b,e=document.createElement("div"),f=document.createElement("div"),g=this;e.id="toggle-button",e.appendChild(f),d.appendChild(e),e.addEventListener("click",function(a){c.ui.visible=!c.ui.visible},!1),Object.defineProperties(g,{visible:{enumerable:!0,get:function(){return e.style.display!=="none"},set:function(a){e.style.display=a?"block":"none"}}})}}),c("ui/context-button",[],function(){return function(a){var b=document.createElement("button");b.id="add-popcorn",b.innerHTML="+Popcorn",b.addEventListener("click",function(){a.ui.contentState==="timeline"?(a.ui.setContentState("add-popcorn"),a.ui.contentStateLocked=!0):(a.ui.contentStateLocked=!1,a.ui.setContentState("timeline"))},!1),a.ui.areas.tools.addComponent(b,{states:["add-popcorn","editor"],transitionIn:function(){b.setAttribute("disabled",!0),b.innerHTML="Done",b.classList.add("add-popcorn-done")},transitionInComplete:function(){b.removeAttribute("disabled")},transitionOut:function(){b.setAttribute("disabled",!0),b.innerHTML="+Popcorn",b.classList.remove("add-popcorn-done")},transitionOutComplete:function(){b.removeAttribute("disabled")}})}}),c("ui/header",["dialog/iframe-dialog"],function(a){var b="Login / Sign Up";return function(c,d){function o(a,b){c.cornfield.login(function(d){if(d.status==="okay"){var e=d.email;c.cornfield.list(function(b){j.innerHTML=e,l.style.display=n,a&&a()})}else p("There was an error logging in. Please try again."),b&&b()})}function p(b,c){var d=new a({type:"iframe",modal:!0,url:"../dialogs/error-message.html",events:{open:function(a){d.send("message",b)},cancel:function(a){d.close(),c&&c()}}});d.open()}function q(b){function d(){c.project.html=c.getHTML(),c.project.data=c.exportProject();var a=JSON.stringify(c.project);c.ui.loadIndicator.start(),c.cornfield.saveas(c.project.id,a,function(a){c.ui.loadIndicator.stop();if(a.error!=="okay"||!a.project||!a.project._id){p("There was a problem saving your project. Please try again.");return}c.project.id=a.project._id,b&&b()})}if(!c.project.name){var e=new a({type:"iframe",modal:!0,url:"../dialogs/save-as.html",events:{open:function(a){e.send("name",null)},submit:function(a){c.project.name=a.data,e.close(),d()},cancel:function(a){e.close()}}});e.open()}else d()}function r(){e.style.width=window.innerWidth+"px"}d=d||{};var e=document.createElement("div"),f,g,h,i,j,k,l,m=d.title||"Butter";e.innerHTML='<div class="logo-drop"></div><h1>'+m+"</h1>"+'<div class="editor-actions">'+'    <button id="butter-header-new">New</button>'+'    <button id="butter-header-save">Save</button>'+'    <button id="butter-header-load">Load</button>'+'    <button id="butter-header-export">Export</button>'+'    <button id="butter-header-share">Share</button>'+'    <button id="butter-header-auth">'+b+"</button>"+'    <button id="butter-header-auth-out">Logout</button>'+"</div>",e.setAttribute("data-butter-exclude",!0),e.id="butter-header",document.body.insertBefore(e,document.body.firstChild),f=document.getElementById("butter-header-new"),g=document.getElementById("butter-header-save"),h=document.getElementById("butter-header-load"),i=document.getElementById("butter-header-share"),j=document.getElementById("butter-header-auth"),k=document.getElementById("butter-header-export"),l=document.getElementById("butter-header-auth-out"),document.body.classList.add("butter-header-spacing");var n=l.style.display;l.style.display="none",k.addEventListener("click",function(b){var d={html:c.getHTML(),json:c.exportProject()},e=new a({type:"iframe",modal:!0,url:"../dialogs/export.html",events:{open:function(){e.send("export",d)},cancel:function(a){e.close()}}});e.open()},!1),f.addEventListener("click",function(b){var c=new a({type:"iframe",modal:!0,url:"../dialogs/quit-confirmation.html",events:{submit:function(a){c.close(),window.location.reload()},cancel:function(a){c.close()}}});c.open()},!1),j.addEventListener("click",function(a){c.cornfield.user()||o()},!1),l.addEventListener("click",function(a){c.cornfield.user()&&c.cornfield.logout(function(a){l.style.display="none",j.innerHTML=b})}),i.addEventListener("click",function(b){function d(){c.cornfield.publish(c.project.id,function(b){if(b.error!=="okay"){p("There was a problem saving your project. Please try again.");return}var c=b.url,d=new a({type:"iframe",modal:!0,url:"../dialogs/share.html",events:{open:function(a){d.send("url",c)},cancel:function(a){d.close()}}});d.open()})}function e(){c.project.id?d():q(d)}c.cornfield.user()?e():o(e)},!1),g.addEventListener("click",function(a){c.cornfield.user()?q():o(q)},!1),h.addEventListener("click",function(b){function d(){c.cornfield.list(function(b){if(b.error!=="okay"){p("There was an error loading your projects. Please try again.");return}var d=new a({type:"iframe",modal:!0,url:"../dialogs/load-project.html",events:{open:function(a){d.send("list",b.projects)},submit:function(a){d.close(),c.cornfield.load(a.data,function(a){if(a.error==="okay"){var b;try{b=JSON.parse(a.project)}catch(a){p("Your project could not be loaded. Please try another.");return}c.clearProject(),c.importProject(b)}else p("Your project could not be loaded. Please try another.")})},cancel:function(a){d.close()}}});d.open()})}c.cornfield.user()?d():o(d)},!1),window.addEventListener("resize",r,!1),r()}}),c("ui/module",["core/eventmanager","./toggler","./logo-spinner","./context-button","./header"],function(a,b,c,d,e){function g(b,c){var d=new a(this),e,f=[],g=this;this.element=e=c||document.createElement("div"),e.id=b,this.items={},this.addComponent=function(a,b){var c=new h(a,b);f.push(c),e.appendChild(c.element)},this.setContentState=function(a){for(var b=0,c=f.length;b<c;++b)f[b].setState(a)}}function h(a,b){b=b||{};var c=a,d=b.transitionIn||function(){},e=b.transitionInComplete||function(){},g=b.transitionOut||function(){},h=b.transitionOutComplete||function(){},i=b.states||[],j=!1;this.element=a,this.setState=function(a){(!i||i.indexOf(a)>-1)&&!j?(j=!0,d(),setTimeout(e,f)):j&&(g(),setTimeout(h,f),j=!1)}}function l(h,l){function u(a){var b={element:document.createElement("div"),items:{}};return b.element.id=a,b}var m=new a(this),n={},o=[],p=!0,q,r=this;n.main=new g("butter-tray"),this.contentStateLocked=!1;var s=n.main.element,t=new b(h,s);s.setAttribute("data-butter-exclude","true"),s.className="butter-tray",n.work=new g("work"),n.statusbar=new g("status-bar"),n.tools=new g("tools");var v=document.createElement("div");v.id="butter-loading-container",q=c(v),s.appendChild(v),s.appendChild(n.statusbar.element),s.appendChild(n.work.element),s.appendChild(n.tools.element),l.enabled!==!1&&(document.body.appendChild(s),h.listen("mediaadded",function(a){a.data.createView()})),this.registerStateToggleFunctions=function(a,b){m.listen("contentstatechanged",function(c){c.data.oldState===a&&b.transitionOut(c),c.data.newState===a&&b.transitionIn(c)})},this.pushContentState=function(a){if(r.contentStateLocked)return;var b=r.contentState;o.push(a),s.setAttribute("data-butter-content-state",r.contentState);for(var c in n)n.hasOwnProperty(c)&&n[c].setContentState(a);m.dispatch("contentstatechanged",{oldState:b,newState:r.contentState})},this.popContentState=function(){if(r.contentStateLocked)return;var a=o.pop(),b=r.contentState;s.setAttribute("data-butter-content-state",b);for(var c in n)n.hasOwnProperty(c)&&n[c].setContentState(b);return m.dispatch("contentstatechanged",{oldState:a,newState:b}),a},this.setContentState=function(a){var b=o.pop();o=[a],s.setAttribute("data-butter-content-state",a);for(var c in n)n.hasOwnProperty(c)&&n[c].setContentState(a);return m.dispatch("contentstatechanged",{oldState:b,newState:a}),b},Object.defineProperties(this,{contentState:{configurable:!1,enumerable:!0,get:function(){return o.length>0?o[o.length-1]:null}},element:{configurable:!1,enumerable:!0,get:function(){return s}},areas:{configurable:!1,enumerable:!0,get:function(){return n}},visible:{enumerable:!0,get:function(){return p},set:function(a){p!==a&&(p=a,p?(s.setAttribute("ui-state","visible"),m.dispatch("uivisibilitychanged",!0)):(s.setAttribute("ui-state","hidden"),m.dispatch("uivisibilitychanged",!1)))}}});var w=h.orderedTrackEvents=[],x=function(a,b){return a.popcornOptions.start>b.popcornOptions.start};h.listen("trackeventadded",function(a){w.push(a.data),w.sort(x)}),h.listen("trackeventremoved",function(a){var b=w.indexOf(a.data);b>-1&&w.splice(b,1)}),h.listen("trackeventupdated",function(a){w.sort(x)});var y=h.orderedTracks=[],z=function(a,b){return a.order>b.order};h.listen("trackadded",function(a){a.data.listen("trackorderchanged",function(a){y.sort(z)}),y.push(a.data),y.sort(z)}),h.listen("trackremoved",function(a){var b=y.indexOf(a.data);b>-1&&y.splice(b,1)});var A={32:function(a){h.currentMedia.ended?h.currentMedia.paused=!1:h.currentMedia.paused=!h.currentMedia.paused},37:function(a){var b=a.shiftKey?k:j;if(h.selectedEvents.length){a.preventDefault();for(var c=0,d=h.selectedEvents.length;c<d;c++)h.selectedEvents[c].moveFrameLeft(b,a.ctrlKey||a.metaKey)}else h.currentTime-=b},38:function(a){var b,c,d;for(var e=0,f=h.selectedEvents.length;e<f;e++)c=h.selectedEvents[e],b=c.track,d=y[y.indexOf(b)-1],d&&(b.removeTrackEvent(c),d.addTrackEvent(c))},39:function(a){a.preventDefault();var b=a.shiftKey?k:j;if(h.selectedEvents.length)for(var c=0,d=h.selectedEvents.length;c<d;c++)h.selectedEvents[c].moveFrameRight(b,a.ctrlKey||a.metaKey);else h.currentTime+=b},40:function(a){var b,c,d;for(var e=0,f=h.selectedEvents.length;e<f;e++)c=h.selectedEvents[e],b=c.track,d=y[y.indexOf(b)+1],d&&(b.removeTrackEvent(c),d.addTrackEvent(c))},27:function(a){for(var b=0;b<h.selectedEvents.length;b++)h.selectedEvents[b].selected=!1;h.selectedEvents=[]},8:function(a){if(h.selectedEvents.length){a.preventDefault();for(var b=0;b<h.selectedEvents.length;b++)h.selectedEvents[b].track.removeTrackEvent(h.selectedEvents[b]);h.selectedEvents=[]}},9:function(a){if(w.length&&h.selectedEvents.length<=1){a.preventDefault();var b=0,c=a.shiftKey?-1:1;w.indexOf(h.selectedEvents[0])>-1&&(b=w.indexOf(h.selectedEvents[0]),w[b+c]?b+=c:a.shiftKey?b=w.length-1:b=0);for(var d=0;d<h.selectedEvents.length;d++)h.selectedEvents[d].selected=!1;h.selectedEvents=[],w[b].selected=!0,h.selectedEvents.push(w[b])}}};window.addEventListener("keydown",function(a){var b=a.which||a.keyCode;b=b===46?8:b,A[b]&&i.indexOf(a.target.nodeName)===-1&&A[b](a)},!1),this.TRANSITION_DURATION=f,t.visible=!1,r.visible=!1,this.loadIndicator={start:function(){q.start(),v.style.display="block"},stop:function(){q.stop(function(){v.style.display="none"})}},r.loadIndicator.start(),h.listen("ready",function(){r.loadIndicator.stop(),r.visible=!0,t.visible=!0,d(h),l.enabled!==!1&&e(h,l)})}var f=500,i=["TEXTAREA","INPUT","VIDEO","AUDIO"],j=.25,k=1;return l.__moduleName="ui",l}),c("modules",["editor/module","timeline/module","cornfield/module","plugin/module","ui/module"],function(){var a=Array.prototype.slice.apply(arguments);return function(b,c,d){var e=[],f=0;for(var g=0;g<a.length;++g){var h=a[g].__moduleName;b[h]=new a[g](b,c[h]),e.push(b[h])}return{ready:function(a){function b(){f++,f===e.length&&a()}for(var c=0;c<e.length;++c)e[c]._start?e[c]._start(b):f++;f===e.length&&a()}}}}),function(){var a=1,b=.01;c("butter-main",["./core/logger","./core/eventmanager","./core/target","./core/media","./core/page","./modules"],function(c,d,e,f,g,h){function l(l){function y(){if(!o)throw new Error("No media object is selected")}function z(c,d,e){var f,g=c.getAttribute("data-butter-plugin-type"),h=d.currentTime,i;h>d.duration&&(h=d.duration-a),h<0&&(h=0),i=h+a,i>d.duration&&(i=d.duration);if(!g){r.log("Invalid trackevent type requested.");return}d.tracks.length===0&&d.addTrack(),f=d.tracks[0];var j=f.addTrackEvent({type:g,popcornOptions:{start:h,end:i,target:e}});return d.currentTime<d.duration-b&&(d.currentTime+=b),j}function A(a){if(o){var b=z(a.data.element,o,a.target.elementID);s.dispatch("trackeventcreated",{trackEvent:b,by:"target"})}else r.log("Warning: No media to add dropped trackevent.")}function B(a){t.addPlayerType(a.data)}function C(a){var b=z(a.data,a.target,"Media Element");s.dispatch("trackeventcreated",{trackEvent:b,by:"media"})}function E(){var a=u.icons,b;for(var c in a)a.hasOwnProperty(c)&&(b=document.createElement("img"),b.src=a[c],b.id=c+"-icon",b.style.display="none",b.setAttribute("data-butter-exclude","true"),document.body.appendChild(b));var d=h(w,u);t=new g(u),D(function(){d.ready(function(){s.dispatch("ready",w)})})}l=l||{};var m={},n=[],o,p=[],q="Butter"+i++,r=new c(q),s=new d(this),t,u={ui:{},icons:{}},v,w=this,x=[];l.debug!==undefined&&c.debug(l.debug),this.project={id:null,name:null,data:null,html:null},this.getManifest=function(a){return y(),o.getManifest(a)},this.getHTML=function(){var a=[];for(var b=0;b<n.length;++b)a.push(n[b].popcornString);return t.getHTML(a)},this.addTarget=function(a){return a instanceof e||(a=new e(a)),p.push(a),a.listen("trackeventrequested",A),r.log("Target added: "+a.name),s.dispatch("targetadded",a),a.isDefault&&(v=a),a},this.removeTarget=function(a){typeof a=="string"&&(a=w.getTargetByType("id",a));var b=p.indexOf(a);return b>-1?(a.unlisten("trackeventrequested",A),p.splice(b,1),delete p[a.name],s.dispatch("targetremoved",a),v===a&&(v=undefined),a):undefined},this.serializeTargets=function(){var a=[];for(var b=0,c=p.length;b<c;++b)a.push(p[b].json);return a},this.getTargetByType=function(a,b){for(var c=0,d=p.length;c<d;c++)if(p[c][a]===b)return p[c];return undefined},this.importProject=function(a){var b,c;if(a.targets)for(b=0,c=a.targets.length;b<c;++b){var d,e=w.targets,g=a.targets[b];for(var h=0,i=e.length;h<i;++h)if(e[h].name===g.name){d=e[h];break}d?d.json=g:w.addTarget(g)}if(a.media)for(b=0,c=a.media.length;b<c;++b){var j=a.media[b],k=w.getMediaByType("target",j.target);k?k.json=j:(k=new f,k.json=j,w.addMedia(k))}},this.exportProject=function(){var a=[];for(var b=0,c=n.length;b<c;++b)a.push(n[b].json);var d={targets:w.serializeTargets(),media:a};return d},this.clearProject=function(){while(p.length>0)w.removeTarget(p[0]);while(n.length>0)n[0].destroy(),w.removeMedia(n[0])},this.getMediaByType=function(a,b){for(var c=0,d=n.length;c<d;c++)if(n[c][a]===b)return n[c];return undefined},this.addMedia=function(a){a instanceof f||(a=new f(a));var b=a.name;n.push(a),s.repeat(a,["mediacontentchanged","mediadurationchanged","mediatargetchanged","mediatimeupdate","mediaready","trackadded","trackremoved","tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated","trackeventeditrequested"]);if(a.tracks.length>0)for(var c=0,d=a.tracks.length;c<d;++c){var e=a.tracks[c];trackEvents=e.trackEvents,a.dispatch("trackadded",e);if(trackEvents.length>0)for(var g=0,h=trackEvents.length;g<h;++g)e.dispatch("trackeventadded",trackEvents[g])}return a.listen("trackeventrequested",C),a.listen("mediaplayertyperequired",B),s.dispatch("mediaadded",a),o||(w.currentMedia=a),a.setupContent(),a},this.removeMedia=function(a){var b=n.indexOf(a);if(b>-1){n.splice(b,1),s.unrepeat(a,["mediacontentchanged","mediadurationchanged","mediatargetchanged","mediatimeupdate","mediaready","trackadded","trackremoved","tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated","trackeventeditrequested"]);var c=a.tracks;for(var d=0,e=c.length;d<e;++d)s.dispatch("trackremoved",c[d]);return a===o&&(o=undefined),a.unlisten("trackeventrequested",C),a.unlisten("mediaplayertyperequired",B),s.dispatch("mediaremoved",a),a}return undefined},this.extend=function(){k.extend(w,[].slice.call(arguments,1))},Object.defineProperties(w,{defaultTarget:{enumerable:!0,get:function(){return v}},config:{enumerable:!0,get:function(){return u}},id:{get:function(){return q},enumerable:!0},tracks:{get:function(){return o.tracks},enumerable:!0},targets:{get:function(){return p},enumerable:!0},currentTime:{get:function(){return y(),o.currentTime},set:function(a){y(),o.currentTime=a},enumerable:!0},duration:{get:function(){return y(),o.duration},set:function(a){y(),o.duration=a},enumerable:!0},media:{get:function(){return n},enumerable:!0},currentMedia:{get:function(){return o},set:function(a){typeof a=="string"&&(a=w.getMediaByType("id",a.id));if(a&&n.indexOf(a)>-1)return o=a,r.log("Media Changed: "+a.name),s.dispatch("mediachanged",a),o},enumerable:!0},selectedEvents:{get:function(){return x},set:function(a){x=a},enumerable:!0},debug:{get:function(){return c.debug()},set:function(a){c.debug(a)},enumerable:!0}});var D=this.preparePage=function(a){var b=t.scrape(),c=b.target,d=b.media;t.preparePopcorn(function(){var b,e,f,g,h;for(b=0,f=c.length;b<f;++b)if(p.length>0)for(e=0,g=p.length;e<g;++e)p[e].id!==c[b].id&&w.addTarget({element:c[b].id});else w.addTarget({element:c[b].id});for(b=0,f=d.length;b<f;b++){h="",["VIDEO","AUDIO"].indexOf(d[b].nodeName)>-1?h=d[b].currentSrc:h=d[b].getAttribute("data-butter-source");if(n.length>0)for(e=0,g=n.length;e<g;++e)n[e].id!==d[b].id&&n[e].url!==h&&w.addMedia({target:d[b].id,url:h});else w.addMedia({target:d[b].id,url:h})}a&&a(),s.dispatch("pageready")})};j.push(this),l.ready&&s.listen("ready",function(a){l.ready(a.data)});if(l.config&&typeof l.config=="string"){var F=new XMLHttpRequest;F.overrideMimeType&&F.overrideMimeType("application/json"),F.open("GET",l.config,!1),F.send(null);if(F.status===200||F.status===0){try{u=JSON.parse(F.responseText)}catch(G){throw new Error("Butter config file not formatted properly.")}E()}else s.dispatch("configerror",w)}else u=l.config,E()}var i=0,j=[],k=function(a){return new l(a)};k.instances=j;if(window.Butter.__waiting){for(var m=0,n=window.Butter.__waiting.length;m<n;++m)k.apply({},window.Butter.__waiting[m]);delete k._waiting}return window.Butter=k,k})}()})()